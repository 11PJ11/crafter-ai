#!/bin/sh
# Pre-push validation for VERSION file and semantic-release config
#
# This hook validates that critical release configuration files exist
# before allowing code to be pushed to remote repositories.
#
# Validates:
# - nWave/VERSION file exists (contains semantic version)
# - .releaserc or release.config.js exists (semantic-release config)

repo_root=$(git rev-parse --show-toplevel)

# Check VERSION file
if [ ! -f "$repo_root/nWave/VERSION" ]; then
    echo "ERROR: Pre-push validation failed."
    echo ""
    echo "[FAIL] VERSION file missing"
    echo "       Expected: nWave/VERSION"
    echo "       Action: Create nWave/VERSION with current version (e.g., '1.5.7')"
    echo ""
    exit 1
fi

# Check semantic-release config
if [ ! -f "$repo_root/.releaserc" ] && [ ! -f "$repo_root/release.config.js" ]; then
    echo "ERROR: Pre-push validation failed."
    echo ""
    echo "[FAIL] semantic-release not configured"
    echo "       Expected: .releaserc or release.config.js"
    echo "       Action: Run 'npx semantic-release-cli setup' or create config manually"
    echo ""
    exit 1
fi

exit 0
