# Task Tool Safety Configuration
# Prevents runaway token consumption from unbounded agent execution

task_defaults:
  # MANDATORY: Always specify max_turns when invoking Task tool
  max_turns:
    default: 35
    background_tasks: 25
    quick_edits: 15
    research: 30
    complex_refactoring: 50

  # Warning thresholds
  context_compaction_limit: 3  # Stop if agent compacts more than 3 times

enforcement:
  # These rules MUST be followed by all orchestrators
  rules:
    - "NEVER invoke Task tool without explicit max_turns parameter"
    - "Background tasks (run_in_background=true) MUST use max_turns <= 25"
    - "If task requires more turns, split into smaller sub-tasks"

  rationale: |
    A background agent without max_turns caused 64 context compactions,
    76 redundant file reads, and consumed 60% of daily token budget
    over 5 hours while making only 5 actual edits.

anti_patterns:
  - name: "Unbounded Background Agent"
    description: "Task with run_in_background=true and no max_turns"
    consequence: "Agent loops indefinitely, re-reading files after each compaction"
    fix: "Always set max_turns, prefer smaller focused tasks"

  - name: "Broad File Reduction Task"
    description: "Asking agent to 'reduce entire file' without specific targets"
    consequence: "Agent reads full file repeatedly, loses context, repeats"
    fix: "Specify exact sections to modify, use line ranges"

recommended_patterns:
  background_edit:
    example: |
      Task(
        subagent_type="general-purpose",
        prompt="Remove lines 500-600 (code_smell_taxonomy) from file X",
        max_turns=15,
        run_in_background=True
      )
    notes: "Specific target, bounded turns, focused scope"

  chunked_reduction:
    example: |
      # Instead of one big task, split into focused chunks:
      Task(prompt="Compress header section (lines 1-75)", max_turns=10)
      Task(prompt="Remove PART 6 package lists (lines 1200-1350)", max_turns=10)
      Task(prompt="Condense PART 3 taxonomy (lines 400-600)", max_turns=15)
    notes: "Each task has clear scope, fast completion, easy recovery"
