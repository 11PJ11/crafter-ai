---
template_type: "interactive-platform-design"
methodology: "nWave ATDD"
wave: "DESIGN"
interactivity_level: "high"
description: "Platform and delivery infrastructure design template for CI/CD, observability, and deployment strategies"
version: "1.0.0"

# ==================================================================================
# DESIGN WAVE: Platform & Delivery Infrastructure Design Template
# ==================================================================================

metadata:
  template_name: "Platform Design Interactive Template"
  methodology_focus: "CI/CD, Infrastructure as Code, Observability, GitOps"
  complexity_support: "Basic → Intermediate → Advanced platform patterns"
  stakeholder_engagement: "Engineering teams, SREs, DevOps practitioners"

# ==================================================================================
# PLATFORM DESIGN FRAMEWORK
# ==================================================================================

platform_approach:
  core_principles:
    - principle: "Continuous Delivery Foundation"
      description: "Deployment pipelines as first-class artifacts"
      source: "Humble & Farley - Continuous Delivery"
      validation_criteria: "Code is always in a deployable state"

    - principle: "Infrastructure as Code"
      description: "All infrastructure defined declaratively in version control"
      source: "Kief Morris - Infrastructure as Code"
      validation_criteria: "No manual infrastructure changes"

    - principle: "GitOps Single Source of Truth"
      description: "Git repository is the source of truth for desired state"
      source: "Weaveworks - GitOps Principles"
      validation_criteria: "Reconciliation loops maintain desired state"

    - principle: "SLO-Driven Operations"
      description: "Service Level Objectives guide operational decisions"
      source: "Google SRE - Site Reliability Engineering"
      validation_criteria: "Error budgets defined and monitored"

    - principle: "Shift-Left Security"
      description: "Security integrated early in the pipeline"
      source: "DevSecOps principles"
      validation_criteria: "Security gates in CI pipeline"

# ==================================================================================
# CI/CD PIPELINE DESIGN FRAMEWORK
# ==================================================================================

pipeline_design:
  stages:
    validate:
      purpose: "Fast feedback on code quality"
      typical_jobs:
        - lint: "Static code analysis"
        - format: "Code formatting verification"
        - type_check: "Type checking (if applicable)"
      target_duration: "< 2 minutes"
      failure_action: "Block pipeline, notify developer"

    test:
      purpose: "Verify code correctness"
      typical_jobs:
        - unit: "Unit tests with coverage"
        - integration: "Integration tests"
        - acceptance: "Acceptance tests (BDD)"
      target_duration: "< 10 minutes"
      failure_action: "Block pipeline, notify developer"

    security:
      purpose: "Security vulnerability detection"
      typical_jobs:
        - sast: "Static Application Security Testing"
        - dependency: "Dependency vulnerability scanning"
        - secrets: "Secret detection in code"
      target_duration: "< 5 minutes"
      failure_action: "Block pipeline, security team alert"

    build:
      purpose: "Create deployable artifacts"
      typical_jobs:
        - compile: "Build application"
        - containerize: "Build container image"
        - push: "Push to registry"
      target_duration: "< 5 minutes"
      failure_action: "Block pipeline, notify developer"

    deploy:
      purpose: "Deploy to target environment"
      typical_jobs:
        - staging: "Deploy to staging"
        - smoke_test: "Verify deployment"
        - production: "Deploy to production (with approval)"
      target_duration: "< 10 minutes"
      failure_action: "Rollback, alert on-call"

  quality_gates:
    - gate: "Test Coverage"
      threshold: ">= 80%"
      enforcement: "blocking"

    - gate: "Security Vulnerabilities"
      threshold: "0 critical, 0 high"
      enforcement: "blocking"

    - gate: "Code Quality"
      threshold: "No new issues"
      enforcement: "warning"

# ==================================================================================
# DEPLOYMENT STRATEGIES
# ==================================================================================

deployment_strategies:
  rolling:
    description: "Gradual replacement of old instances"
    use_when:
      - "Stateless applications"
      - "Backward compatible changes"
    risk_level: "low"
    rollback_time: "minutes"

  blue_green:
    description: "Two identical environments, switch traffic"
    use_when:
      - "Need instant rollback capability"
      - "Database migrations are minimal"
    risk_level: "low"
    rollback_time: "seconds"

  canary:
    description: "Gradual traffic shift with monitoring"
    use_when:
      - "High-traffic services"
      - "Need to validate with real traffic"
    risk_level: "low"
    rollback_time: "seconds"

  progressive:
    description: "Feature flags with gradual rollout"
    use_when:
      - "New features need validation"
      - "A/B testing required"
    risk_level: "very low"
    rollback_time: "instant"

# ==================================================================================
# OBSERVABILITY FRAMEWORK
# ==================================================================================

observability:
  three_pillars:
    metrics:
      purpose: "Quantitative measurements of system behavior"
      golden_signals:
        - latency: "Request duration distribution"
        - traffic: "Requests per second"
        - errors: "Error rate percentage"
        - saturation: "Resource utilization"
      tools: ["Prometheus", "Grafana", "Datadog"]

    logs:
      purpose: "Discrete events with context"
      best_practices:
        - "Structured logging (JSON)"
        - "Correlation IDs for tracing"
        - "Log levels (DEBUG, INFO, WARN, ERROR)"
      tools: ["Loki", "Elasticsearch", "CloudWatch"]

    traces:
      purpose: "Request flow across services"
      best_practices:
        - "Distributed tracing enabled"
        - "Span context propagation"
        - "Service dependency mapping"
      tools: ["Jaeger", "Zipkin", "OpenTelemetry"]

  alerting:
    slo_based:
      approach: "Alert on SLO burn rate, not thresholds"
      source: "Google SRE - Alerting on SLOs"
      tiers:
        - critical: "Page immediately, SLO at risk"
        - warning: "Slack notification, investigate"
        - info: "Dashboard only, for awareness"

# ==================================================================================
# INFRASTRUCTURE AS CODE PATTERNS
# ==================================================================================

infrastructure_patterns:
  modular_design:
    principle: "Reusable, composable modules"
    implementation:
      - "Environment-agnostic base modules"
      - "Environment-specific configurations"
      - "Shared module registry"

  state_management:
    principle: "Secure, consistent state handling"
    implementation:
      - "Remote state storage (S3, GCS)"
      - "State locking for concurrency"
      - "State encryption at rest"

  testing:
    principle: "Infrastructure code is tested code"
    implementation:
      - "Unit tests for modules"
      - "Integration tests for stacks"
      - "Policy as code (OPA, Sentinel)"

# ==================================================================================
# GITHUB ACTIONS WORKFLOW PATTERNS
# ==================================================================================

github_actions_patterns:
  reusable_workflows:
    description: "DRY principle for CI/CD"
    pattern: ".github/workflows/reusable-*.yml"

  matrix_builds:
    description: "Parallel execution across configurations"
    use_for: "Multi-platform, multi-version testing"

  environment_protection:
    description: "Approval gates for sensitive environments"
    implementation:
      - "Required reviewers"
      - "Wait timer"
      - "Branch restrictions"

  secrets_management:
    description: "Secure handling of sensitive data"
    implementation:
      - "GitHub Secrets for credentials"
      - "OIDC for cloud authentication"
      - "No secrets in code"
