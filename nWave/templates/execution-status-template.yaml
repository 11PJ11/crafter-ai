# Execution Status Template - Schema v1.0
# Lightweight state tracker for TDD cycle execution across steps
# Replaces individual step JSON files to reduce token usage

execution_status:
  # Schema metadata
  schema_version: "1.0"
  created_at: ""  # ISO 8601 timestamp
  updated_at: ""  # ISO 8601 timestamp

  # Project identification
  project_id: ""  # kebab-case project identifier (e.g., "auth-upgrade")

  # Current execution pointer (for phase-level resume)
  current:
    step_id: null  # Currently executing step (e.g., "01-02") or null if none
    phase_index: null  # Current phase index (0-7) or null
    phase_name: null  # Current phase name (e.g., "GREEN") or null
    started_at: null  # When current phase started (ISO 8601) or null
    turn_count: 0  # Agent turn count for timeout monitoring
    last_checkpoint: null  # Last successful checkpoint timestamp or null

  # Completed steps log (minimal tracking)
  completed_steps: []
    # Each entry:
    # - step_id: "01-01"
    #   completed_at: "2026-01-29T14:30:15Z"
    #   phases_executed: 8  # Number of phases completed
    #   commit_sha: "abc123def"  # Git commit hash
    #   duration_minutes: 85  # Total execution time
    #   files_modified:              # Actual files changed by this step
    #     implementation:            # src/ files (mutation testing targets)
    #       - "src/des/templates/boundary_rules_template.py"
    #     tests:                     # test files
    #       - "tests/des/unit/test_boundary_rules_template.py"

  # Phase checkpoint for current step (enables phase-level resume)
  step_checkpoint:
    step_id: null  # Step being tracked or null
    phases: []
      # Each phase entry (8 phases total from canonical schema):
      # - phase_index: 0  # 0-7
      #   phase_name: "PREPARE"  # PREPARE, RED_ACCEPTANCE, RED_UNIT, GREEN, REVIEW, REFACTOR_CONTINUOUS, REFACTOR_L4, COMMIT
      #   status: "NOT_EXECUTED"  # NOT_EXECUTED, IN_PROGRESS, COMPLETED, SKIPPED
      #   started_at: null  # ISO 8601 or null
      #   completed_at: null  # ISO 8601 or null
      #   duration_minutes: null  # Numeric or null
      #   turn_count: 0  # Agent turns for this phase
      #   outcome: null  # "PASS", "FAIL", or null
      #   blocked_by: null  # For SKIPPED status: reason with valid prefix
      #   notes: null  # Optional phase-specific notes

      # Valid SKIPPED prefixes (allow commit):
      # - "BLOCKED_BY_DEPENDENCY:" - External dependency unavailable
      # - "NOT_APPLICABLE:" - Phase not applicable for task type
      # - "APPROVED_SKIP:" - Explicitly approved by reviewer
      # - "CHECKPOINT_PENDING:" - Waiting at TDD checkpoint

      # Invalid SKIPPED prefixes (block commit):
      # - "DEFERRED:" - Incomplete work that must be resolved

# Usage Instructions:
# 1. Copy this template to: docs/feature/{project-id}/execution-status.yaml
# 2. Set project_id, created_at, updated_at
# 3. Initialize step_checkpoint.phases with 8 phases (from canonical schema)
# 4. Update after EACH phase execution (no batching)
# 5. Move completed step to completed_steps array when all phases done
# 6. Clear step_checkpoint when step completes
# 7. In COMMIT phase: populate files_modified using git diff --name-only HEAD~1
#    - implementation: files under src/ or lib/ (excluding __init__.py)
#    - tests: files under tests/
#    - Orchestrator uses this data for mutation testing scope discovery

# Integration with TDD Cycle:
# - Phase 0 (PREPARE): Remove @skip, verify setup
# - Phase 1 (RED_ACCEPTANCE): Run test, expect FAIL
# - Phase 2 (RED_UNIT): Write failing unit tests
# - Phase 3 (GREEN): Implement to pass all tests
# - Phase 4 (REVIEW): Quality review + post-refactor validation
# - Phase 5 (REFACTOR_CONTINUOUS): L1-L3 progressive refactoring
# - Phase 6 (REFACTOR_L4): Architecture patterns (OPTIONAL)
# - Phase 7 (COMMIT): Final validate + commit

# Pre-Commit Hook Validation:
# - No phases left IN_PROGRESS (indicates abandoned execution)
# - EXECUTED phases must have outcome field
# - SKIPPED phases must have valid blocked_by prefix
# - Phase sequence has no gaps (0, 1, 2, 3... no skipping indices)
# - No DEFERRED prefixes (blocks commit until resolved)
