{
  "task_id": "03-01",
  "step_name": "Verify missing TIMEOUT_INSTRUCTION blocks invocation",
  "project_id": "des-us006",
  "phase_id": "03",
  "acceptance_test_scenario": "test_scenario_008",
  "description": "Test that prompts missing TIMEOUT_INSTRUCTION fail pre-invocation validation with specific error message. This validates that the validator's requirement is enforced.",
  "acceptance_criteria": [
    "PromptValidator.validate() checks for TIMEOUT_INSTRUCTION in MANDATORY_SECTIONS",
    "When missing, validator returns is_valid=False",
    "Error message includes 'TIMEOUT_INSTRUCTION' and 'MISSING'",
    "Task invocation is BLOCKED before execution",
    "test_scenario_008 GREEN: Missing section blocks invocation"
  ],
  "dependencies": [
    "02-01"
  ],
  "suggested_agent": "software-crafter",
  "estimated_hours": 2,
  "tdd_cycle": {
    "acceptance_test": {
      "scenario_name": "test_scenario_008_missing_timeout_instruction_blocks_invocation",
      "test_file": "tests/des/acceptance/test_us006_turn_discipline.py",
      "test_file_format": "py_pytest",
      "scenario_index": 8,
      "initially_ignored": false,
      "is_walking_skeleton": false,
      "mapped_scenario": {
        "description": "Validates validation FAILS when TIMEOUT_INSTRUCTION missing",
        "scenario_function": "test_scenario_008_missing_timeout_instruction_blocks_invocation",
        "scenario_description": "Missing blocks invocation",
        "mapping_type": "feature",
        "notes": "Enforces validator requirement for TIMEOUT_INSTRUCTION"
      }
    },
    "expected_unit_tests": [
      "test_validator_checks_timeout_instruction_in_mandatory_sections",
      "test_validator_returns_invalid_when_timeout_missing",
      "test_validator_error_message_includes_timeout_instruction",
      "test_validator_error_message_includes_missing"
    ],
    "mock_boundaries": {
      "allowed_ports": [],
      "forbidden_domain_classes": [],
      "in_memory_adapters": []
    },
    "tdd_phase_tracking": {
      "current_phase": "REFACTOR_L4",
      "active_e2e_test": "test_scenario_008_missing_timeout_instruction_blocks_invocation",
      "inactive_e2e_tests": "All other @pytest.mark.skip scenarios remain disabled",
      "phases_completed": ["PREPARE", "RED_ACCEPTANCE", "RED_UNIT", "GREEN", "REVIEW", "REFACTOR_CONTINUOUS"],
      "test_results": {
        "total": 6,
        "passed": 6,
        "failed": 0,
        "skipped": 0
      }
    },
    "phase_execution_log": [
      {
        "phase_name": "PREPARE",
        "status": "EXECUTED",
        "started_at": "2026-01-29T19:45:00Z",
        "ended_at": "2026-01-29T19:46:00Z",
        "outcome": "SUCCESS: Removed @pytest.mark.skip from test_scenario_008. Verified only 1 scenario enabled.",
        "notes": "Acceptance test test_scenario_008_missing_timeout_instruction_blocks_invocation is now active",
        "blocked_by": null,
        "turn_count": 1
      },
      {
        "phase_name": "RED_ACCEPTANCE",
        "status": "EXECUTED",
        "started_at": "2026-01-29T19:46:00Z",
        "ended_at": "2026-01-29T19:47:00Z",
        "outcome": "VALID_RED: Test fails with ModuleNotFoundError: No module named 'src.des.validation' - business logic not implemented",
        "notes": "Failure classification: BUSINESS_LOGIC_NOT_IMPLEMENTED. PromptValidator class does not exist.",
        "blocked_by": null,
        "turn_count": 1
      },
      {
        "phase_name": "RED_UNIT",
        "status": "EXECUTED",
        "started_at": "2026-01-29T19:47:00Z",
        "ended_at": "2026-01-29T19:49:00Z",
        "outcome": "VALID_RED: All 5 unit tests fail with ModuleNotFoundError. Tests cover: MANDATORY_SECTIONS check, is_valid=False when missing, error messages include 'TIMEOUT_INSTRUCTION' and 'MISSING'",
        "notes": "Created test_prompt_validator.py with 5 unit tests. All fail on assertion (correct RED state). Test file: tests/des/unit/adapters/drivers/validators/test_prompt_validator.py",
        "blocked_by": null,
        "turn_count": 1
      },
      {
        "phase_name": "GREEN",
        "status": "EXECUTED",
        "started_at": "2026-01-29T19:49:00Z",
        "ended_at": "2026-01-29T19:52:00Z",
        "outcome": "SUCCESS: All 6 tests pass (5 unit + 1 acceptance). Created src/des/validation.py as facade over existing TemplateValidator. PromptValidator validates TIMEOUT_INSTRUCTION is in MANDATORY_SECTIONS and returns is_valid=False when missing.",
        "notes": "Implementation reuses existing MandatorySectionChecker which already includes TIMEOUT_INSTRUCTION. Green acceptance is consequence of green unit tests.",
        "blocked_by": null,
        "turn_count": 1
      },
      {
        "phase_name": "REVIEW",
        "status": "EXECUTED",
        "started_at": "2026-01-29T19:52:00Z",
        "ended_at": "2026-01-29T19:54:00Z",
        "outcome": "APPROVED: Implementation quality verified. No over-engineering, YAGNI compliant, reuses existing code. Test quality: isolated, no domain mocks, real components. All 5 ACs covered. Code readability: clear naming, self-documenting.",
        "notes": "Comprehensive review checklist: implementation bias (PASS), test quality (PASS), code readability (PASS), AC coverage (100%). Zero defects found.",
        "blocked_by": null,
        "turn_count": 1
      },
      {
        "phase_name": "REFACTOR_CONTINUOUS",
        "status": "SKIPPED",
        "started_at": "2026-01-29T19:54:00Z",
        "ended_at": "2026-01-29T19:55:00Z",
        "outcome": "NOT_APPLICABLE: Code already follows L1 (clear naming), L2 (simple logic), L3 (single responsibility facade pattern). Implementation is minimal facade with proper delegation. No refactoring opportunities identified.",
        "notes": "Reviewed for naming clarity, complexity reduction, and responsibility organization. All levels already satisfied.",
        "blocked_by": "NOT_APPLICABLE: Implementation is already high quality with clear names, simple logic, and proper responsibility separation",
        "turn_count": 1
      },
      {
        "phase_name": "REFACTOR_L4",
        "status": "SKIPPED",
        "started_at": "2026-01-29T19:55:00Z",
        "ended_at": "2026-01-29T19:56:00Z",
        "outcome": "NOT_APPLICABLE: Implementation already uses Facade pattern appropriately. Architecture is clean with proper separation of concerns (facade delegates to existing TemplateValidator and MandatorySectionChecker).",
        "notes": "Facade pattern is the appropriate architectural pattern for this use case. No L4 refactoring needed.",
        "blocked_by": "NOT_APPLICABLE: Facade pattern already applied, architecture is appropriate for requirements",
        "turn_count": 1
      },
      {
        "phase_name": "COMMIT",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": "Absorbs FINAL_VALIDATE (metadata checks only)",
        "blocked_by": null,
        "turn_count": 0
      }
    ]
  },
  "quality_gates": {
    "acceptance_tests_pass": true,
    "unit_tests_pass": true,
    "mutation_score_threshold": 75,
    "code_coverage_threshold": 80,
    "solid_principles_followed": true,
    "port_boundary_compliance": true
  },
  "validation": {
    "status": "approved",
    "reviewed_by": "software-crafter-reviewer",
    "reviewed_at": "2026-01-29T12:20:42.080528+00:00",
    "review_summary": "Format validation PASSED - all required fields present and correct. File complies with canonical schema v2.0.0. No HIGH severity violations found. File ready for execution."
  }
}
