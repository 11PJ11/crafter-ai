{
  "task_id": "01-01",
  "step_name": "Design TIMEOUT_INSTRUCTION content structure",
  "project_id": "des-us006",
  "phase_id": "01",
  "acceptance_test_scenario": "test_scenario_009",
  "description": "Create data structure and template for TIMEOUT_INSTRUCTION section content. Define the 4 required elements (turn budget, checkpoints, early exit, logging) with specific formatting that agents can parse and follow.",
  "acceptance_criteria": [
    "TIMEOUT_INSTRUCTION section template defined with markdown formatting",
    "Turn budget element specifies ~50 turns with clear guidance",
    "Progress checkpoints defined at turn ~10, ~25, ~40, ~50 with TDD phase mapping",
    "Early exit protocol documented (save progress, set IN_PROGRESS, return)",
    "Turn logging instruction specifies format: '[Turn X] Phase Y'",
    "Template is ready for integration into orchestrator.render_prompt()"
  ],
  "dependencies": [],
  "suggested_agent": "software-crafter",
  "estimated_hours": 3,
  "tdd_cycle": {
    "acceptance_test": {
      "scenario_name": "test_scenario_009_timeout_instruction_has_complete_structure",
      "test_file": "tests/des/acceptance/test_us006_turn_discipline.py",
      "test_file_format": "py_pytest",
      "scenario_index": 9,
      "initially_ignored": true,
      "is_walking_skeleton": false,
      "mapped_scenario": {
        "description": "Validates complete TIMEOUT_INSTRUCTION structure with all 4 elements",
        "scenario_function": "test_scenario_009_timeout_instruction_has_complete_structure",
        "scenario_description": "Complete structure validation",
        "mapping_type": "feature",
        "notes": "This step designs the structure that step 02-00 and 02-01 will implement"
      }
    },
    "expected_unit_tests": [
      "test_timeout_instruction_template_structure",
      "test_turn_budget_element_format",
      "test_progress_checkpoints_definition",
      "test_early_exit_protocol_steps",
      "test_turn_logging_format_specification"
    ],
    "mock_boundaries": {
      "allowed_ports": [],
      "forbidden_domain_classes": [],
      "in_memory_adapters": []
    },
    "tdd_phase_tracking": {
      "current_phase": "COMPLETED",
      "active_e2e_test": "@pytest.mark.skip removed from test_scenario_009",
      "inactive_e2e_tests": "All other @pytest.mark.skip scenarios remain disabled",
      "phases_completed": [
        "PREPARE",
        "RED_ACCEPTANCE",
        "RED_UNIT",
        "GREEN",
        "REVIEW",
        "REFACTOR_CONTINUOUS",
        "REFACTOR_L4",
        "COMMIT"
      ],
      "test_results": {
        "total": 6,
        "passed": 6,
        "failed": 0,
        "skipped": 0
      }
    },
    "phase_execution_log": [
      {
        "phase_name": "PREPARE",
        "phase_index": 1,
        "started_at": "2026-01-29T12:30:00.000000+00:00",
        "completed_at": "2026-01-29T12:31:00.000000+00:00",
        "duration_minutes": 1,
        "outcome": "EXECUTED",
        "notes": "Removed @pytest.mark.skip from test_scenario_009. Entry point wiring check: render_full_prompt method does not exist yet (expected - this is the RED state).",
        "artifacts": [
          "tests/des/acceptance/test_us006_turn_discipline.py"
        ],
        "validation_result": {
          "gate_id": "G1",
          "gate_name": "Exactly ONE acceptance test active",
          "passed": true,
          "evidence": "test_scenario_009 enabled, all other scenarios remain disabled"
        }
      },
      {
        "phase_name": "RED_ACCEPTANCE",
        "phase_index": 2,
        "started_at": "2026-01-29T12:31:00.000000+00:00",
        "completed_at": "2026-01-29T12:32:00.000000+00:00",
        "duration_minutes": 1,
        "outcome": "EXECUTED",
        "notes": "Test fails with AttributeError: 'DESOrchestrator' object has no attribute 'render_full_prompt'. Valid RED state - business logic not implemented.",
        "artifacts": [],
        "validation_result": {
          "gate_id": "G2",
          "gate_name": "Acceptance test fails for business logic not implemented",
          "passed": true,
          "evidence": "AttributeError on render_full_prompt - method does not exist (expected)"
        }
      },
      {
        "phase_name": "RED_UNIT",
        "phase_index": 3,
        "started_at": "2026-01-29T12:32:00.000000+00:00",
        "completed_at": "2026-01-29T12:35:00.000000+00:00",
        "duration_minutes": 3,
        "outcome": "EXECUTED",
        "notes": "Created 5 unit tests for TimeoutInstructionTemplate. All tests fail with NotImplementedError on render() method. Valid RED state - tests can execute but assertions fail because business logic not implemented.",
        "artifacts": [
          "tests/des/unit/application/test_timeout_instruction_template.py",
          "src/des/domain/timeout_instruction_template.py"
        ],
        "validation_result": {
          "gate_id": "G3",
          "gate_name": "Unit test fails on assertion",
          "passed": true,
          "evidence": "NotImplementedError raised by render() - fails at assertion point, not setup"
        }
      },
      {
        "phase_name": "GREEN",
        "phase_index": 4,
        "started_at": "2026-01-29T12:35:00.000000+00:00",
        "completed_at": "2026-01-29T12:42:00.000000+00:00",
        "duration_minutes": 7,
        "outcome": "EXECUTED",
        "notes": "Implemented TimeoutInstructionTemplate.render() with all 4 elements (turn budget, checkpoints, early exit, logging). Added render_full_prompt() method to orchestrator. All unit tests pass (5/5). Acceptance test passes (test_scenario_009).",
        "artifacts": [
          "src/des/domain/timeout_instruction_template.py",
          "src/des/application/orchestrator.py"
        ],
        "validation_result": {
          "gate_id": "G6",
          "gate_name": "All tests green (unit + acceptance)",
          "passed": true,
          "evidence": "6 tests passed (5 unit + 1 acceptance): 100% pass rate"
        }
      },
      {
        "phase_name": "REVIEW",
        "phase_index": 5,
        "started_at": "2026-01-29T12:42:00.000000+00:00",
        "completed_at": "2026-01-29T12:45:00.000000+00:00",
        "duration_minutes": 3,
        "outcome": "EXECUTED",
        "notes": "Self-review completed (software-crafter in review mode). APPROVED. Strengths: YAGNI compliant, behavior-driven tests, real components, all AC covered. Minor suggestion: consider extracting template elements to separate methods in future (not blocking).",
        "artifacts": [],
        "validation_result": {
          "gate_id": "G5",
          "gate_name": "Business language verified in tests",
          "passed": true,
          "evidence": "Tests use business terms: turn budget, checkpoints, early exit, logging. Template uses ubiquitous language from acceptance criteria."
        }
      },
      {
        "phase_name": "REFACTOR_CONTINUOUS",
        "phase_index": 6,
        "started_at": "2026-01-29T12:45:00.000000+00:00",
        "completed_at": "2026-01-29T12:48:00.000000+00:00",
        "duration_minutes": 3,
        "outcome": "EXECUTED",
        "notes": "Applied L1+L2+L3 refactoring. Extracted 4 private methods from render(): _render_turn_budget(), _render_progress_checkpoints(), _render_early_exit_protocol(), _render_turn_logging(). Improved method-level single responsibility. All tests remain green.",
        "artifacts": [
          "src/des/domain/timeout_instruction_template.py"
        ],
        "validation_result": {
          "gate_id": "G6",
          "gate_name": "Tests green after refactoring",
          "passed": true,
          "evidence": "6 tests passed after Extract Method refactoring"
        }
      },
      {
        "phase_name": "REFACTOR_L4",
        "phase_index": 7,
        "started_at": "2026-01-29T12:48:00.000000+00:00",
        "completed_at": "2026-01-29T12:49:00.000000+00:00",
        "duration_minutes": 1,
        "outcome": "NOT_APPLICABLE: Template is simple data structure - no architecture patterns needed. Current design (single class with private methods) is appropriate.",
        "notes": "Skipped L4 refactoring. This is a template renderer, not a complex domain model requiring Strategy/Factory patterns. YAGNI applies - no architectural complexity needed for this use case.",
        "artifacts": [],
        "validation_result": {
          "gate_id": "G6",
          "gate_name": "Tests green after refactoring",
          "passed": true,
          "evidence": "N/A - no refactoring applied, tests remain green"
        }
      },
      {
        "phase_name": "COMMIT",
        "phase_index": 8,
        "started_at": "2026-01-29T12:49:00.000000+00:00",
        "completed_at": "2026-01-29T12:52:00.000000+00:00",
        "duration_minutes": 3,
        "outcome": "EXECUTED",
        "notes": "Created git commit 270b4fc with all 8-phase TDD cycle metadata. Pre-commit hooks validated: YAML, JSON, ruff, formatting. All tests passing. Step complete and ready for handoff.",
        "artifacts": [
          "git commit 270b4fc"
        ],
        "validation_result": {
          "gate_id": "ALL",
          "gate_name": "All quality gates passing",
          "passed": true,
          "evidence": "G1-G6 all passed. Tests: 6/6 green. Commit: 270b4fc created successfully."
        }
      }
    ]
  },
  "quality_gates": {
    "acceptance_tests_pass": true,
    "unit_tests_pass": true,
    "mutation_score_threshold": 75,
    "code_coverage_threshold": 80,
    "solid_principles_followed": true,
    "port_boundary_compliance": true
  },
  "validation": {
    "status": "approved",
    "reviewed_by": "software-crafter-reviewer",
    "reviewed_at": "2026-01-29T12:20:42.080528+00:00",
    "review_summary": "Format validation PASSED - all required fields present and correct. File complies with canonical schema v2.0.0. No HIGH severity violations found. File ready for execution."
  }
}
