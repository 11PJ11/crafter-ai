{
  "schema_version": "2.0",
  "task_id": "01-03",
  "project_id": "installation-environment-detection",
  "step_type": "atdd",
  "execution_agent": "software-crafter",

  "self_contained_context": {
    "background": "The context_detector module needs CI and container detection capabilities to adjust installer behavior for automated pipelines and containerized environments.",
    "prerequisites": [
      "01-02: Context Detector - Terminal/Claude Detection must be complete"
    ],
    "relevant_files": [
      "scripts/install/context_detector.py",
      "tests/unit/test_context_detector.py"
    ],
    "technical_context": "Extend context_detector.py with is_ci_environment() checking GITHUB_ACTIONS, GITLAB_CI, CI, JENKINS_URL environment variables. Add is_container_environment() checking /.dockerenv file existence and KUBERNETES_SERVICE_HOST. CI and container detection influences verbose mode and color output."
  },

  "task_specification": {
    "name": "Context Detector - CI/Container Detection",
    "description": "Extend context_detector.py with CI environment detection (GITHUB_ACTIONS, GITLAB_CI, CI, JENKINS_URL) and container detection (Docker, Kubernetes).",
    "motivation": "CI environments need verbose output without colors. Container environments may need warnings about non-persistent installations.",
    "detailed_instructions": "1. Add is_ci_environment() function checking CI-related environment variables. 2. Add is_container_environment() checking /.dockerenv and KUBERNETES_SERVICE_HOST. 3. Add get_execution_context() returning structured context info. 4. Create tests/unit/test_context_detector_ci.py with comprehensive CI/container tests.",
    "acceptance_criteria": "CI detection via GITHUB_ACTIONS environment variable; CI detection via GITLAB_CI environment variable; CI detection via generic CI environment variable; CI detection via JENKINS_URL environment variable; Container environment triggers warning but not block; Kubernetes container environment is detected; CI inside container shows both contexts; Non-CI non-container environment uses default behavior",
    "estimated_hours": 2
  },

  "dependencies": {
    "requires": ["01-02"],
    "blocking": ["03-03"]
  },

  "state": {
    "status": "TODO",
    "assigned_to": null,
    "started_at": null,
    "completed_at": null
  },

  "tdd_cycle": {
    "acceptance_test": {
      "scenario_name": "CI detection via GITHUB_ACTIONS environment variable",
      "test_file": "tests/acceptance/installation/test_context_detector_ci.feature",
      "test_file_format": "py_pytest",
      "scenario_index": 0,
      "initially_ignored": true,
      "is_walking_skeleton": false,
      "mapped_scenario": {
        "description": "Validates CI detection for GitHub Actions",
        "scenario_function": "test_ci_detection_github_actions",
        "scenario_description": "CI detection via GITHUB_ACTIONS environment variable",
        "mapping_type": "feature",
        "notes": "First of 8 scenarios for CI/container detection"
      }
    },
    "expected_unit_tests": [
      "test_is_ci_github_actions",
      "test_is_ci_gitlab",
      "test_is_ci_generic",
      "test_is_ci_jenkins",
      "test_is_container_docker",
      "test_is_container_kubernetes",
      "test_ci_inside_container",
      "test_default_non_ci_non_container"
    ],
    "mock_boundaries": {
      "allowed_ports": [],
      "forbidden_domain_classes": ["ContextDetector"],
      "in_memory_adapters": []
    },
    "tdd_phase_tracking": {
      "current_phase": "NOT_STARTED",
      "active_e2e_test": "",
      "inactive_e2e_tests": "All other @skip scenarios remain disabled",
      "phases_completed": [],
      "test_results": {
        "total": null,
        "passed": null,
        "failed": null,
        "skipped": null
      }
    },
    "phase_execution_log": [
      {"phase_name": "PREPARE", "phase_index": 0, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null},
      {"phase_name": "RED_ACCEPTANCE", "phase_index": 1, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null},
      {"phase_name": "RED_UNIT", "phase_index": 2, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null},
      {"phase_name": "GREEN", "phase_index": 3, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null},
      {"phase_name": "REVIEW", "phase_index": 4, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null},
      {"phase_name": "REFACTOR_CONTINUOUS", "phase_index": 5, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null},
      {"phase_name": "REFACTOR_L4", "phase_index": 6, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null},
      {"phase_name": "COMMIT", "phase_index": 7, "status": "NOT_EXECUTED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": null, "blocked_by": null}
    ]
  },

  "quality_gates": {
    "test_coverage_minimum": 80,
    "all_acceptance_tests_pass": true,
    "no_linting_errors": true
  }
}
