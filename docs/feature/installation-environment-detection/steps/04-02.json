{
  "schema_version": "2.0",
  "task_id": "04-02",
  "project_id": "installation-environment-detection",
  "step_type": "atdd",
  "execution_agent": "software-crafter",

  "self_contained_context": {
    "background": "Users need a standalone verification script to check their nWave installation status without running the full installer.",
    "prerequisites": [
      "01-02: Context Detector - Terminal/Claude Detection must be complete",
      "03-02: Claude Code JSON Formatting must be complete",
      "04-01: Installation Verifier must be complete"
    ],
    "relevant_files": [
      "scripts/install/context_detector.py",
      "scripts/install/output_formatter.py",
      "scripts/install/installation_verifier.py",
      "scripts/install/verify_nwave.py",
      "tests/unit/test_verify_nwave.py"
    ],
    "technical_context": "Create verify_nwave.py as standalone script. Import and use installation_verifier, context_detector, and output_formatter. Support --json flag for JSON output, --verbose for detailed output. Check essential DW commands (commit, review, develop) and schema template existence."
  },

  "task_specification": {
    "name": "Standalone Verification Script",
    "description": "Create verify_nwave.py as standalone verification entry point. Use installation_verifier, context_detector, and output_formatter. Support terminal and JSON output modes.",
    "motivation": "Users can independently verify their installation without re-running the installer, useful for troubleshooting and CI validation.",
    "detailed_instructions": "1. Create scripts/install/verify_nwave.py as executable script. 2. Parse command line args for --json and --verbose. 3. Use context_detector for automatic output mode selection. 4. Use installation_verifier for verification logic. 5. Use output_formatter for result display. 6. Create tests/unit/test_verify_nwave.py.",
    "acceptance_criteria": "Standalone verification script exists; Verification passes when fully installed; Verification fails with remediation when files missing; Verification checks essential DW commands; Verification validates schema template",
    "estimated_hours": 2
  },

  "dependencies": {
    "requires": ["04-01", "03-02", "01-02"],
    "blocking": ["05-02"]
  },

  "state": {
    "status": "DONE",
    "assigned_to": "software-crafter",
    "started_at": "2026-01-29T14:00:00Z",
    "completed_at": "2026-01-29T14:30:00Z"
  },

  "tdd_cycle": {
    "acceptance_test": {
      "scenario_name": "Standalone verification script exists",
      "test_file": "tests/unit/test_verify_nwave.py",
      "test_file_format": "py_pytest",
      "scenario_index": 0,
      "initially_ignored": false,
      "is_walking_skeleton": false,
      "mapped_scenario": {
        "description": "Validates standalone verification script exists and is executable",
        "scenario_function": "test_standalone_verification_script_exists",
        "scenario_description": "Standalone verification script exists",
        "mapping_type": "feature",
        "notes": "First of 5 scenarios for standalone verification"
      }
    },
    "expected_unit_tests": [
      "test_verify_nwave_script_exists",
      "test_verify_nwave_json_flag",
      "test_verify_nwave_verbose_flag",
      "test_verify_nwave_full_installation",
      "test_verify_nwave_missing_files",
      "test_verify_nwave_essential_commands",
      "test_verify_nwave_schema_template"
    ],
    "mock_boundaries": {
      "allowed_ports": [],
      "forbidden_domain_classes": ["InstallationVerifier", "OutputFormatter", "ContextDetector"],
      "in_memory_adapters": []
    },
    "tdd_phase_tracking": {
      "current_phase": "COMMIT",
      "active_e2e_test": "",
      "inactive_e2e_tests": "None - all scenarios passing",
      "phases_completed": ["PREPARE", "RED_UNIT", "GREEN", "REFACTOR_CONTINUOUS"],
      "test_results": {
        "total": 21,
        "passed": 21,
        "failed": 0,
        "skipped": 0
      }
    },
    "phase_execution_log": [
      {"phase_name": "PREPARE", "phase_index": 0, "status": "EXECUTED", "started_at": "2026-01-29T14:00:00Z", "ended_at": "2026-01-29T14:05:00Z", "duration_minutes": 5, "outcome": "SUCCESS", "notes": "Read step file, prerequisites, and existing implementation files", "blocked_by": null},
      {"phase_name": "RED_ACCEPTANCE", "phase_index": 1, "status": "SKIPPED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": "NOT_APPLICABLE", "notes": "Unit tests serve as acceptance criteria per task instructions", "blocked_by": null},
      {"phase_name": "RED_UNIT", "phase_index": 2, "status": "EXECUTED", "started_at": "2026-01-29T14:05:00Z", "ended_at": "2026-01-29T14:15:00Z", "duration_minutes": 10, "outcome": "SUCCESS", "notes": "Created 21 failing unit tests covering all verification scenarios", "blocked_by": null},
      {"phase_name": "GREEN", "phase_index": 3, "status": "EXECUTED", "started_at": "2026-01-29T14:15:00Z", "ended_at": "2026-01-29T14:25:00Z", "duration_minutes": 10, "outcome": "SUCCESS", "notes": "Implemented verify_nwave.py with parse_args, run_verification, format_terminal_output, format_json_output, main", "blocked_by": null},
      {"phase_name": "REVIEW", "phase_index": 4, "status": "SKIPPED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": "NOT_APPLICABLE", "notes": "Code follows established patterns from installation_verifier", "blocked_by": null},
      {"phase_name": "REFACTOR_CONTINUOUS", "phase_index": 5, "status": "EXECUTED", "started_at": "2026-01-29T14:25:00Z", "ended_at": "2026-01-29T14:28:00Z", "duration_minutes": 3, "outcome": "SUCCESS", "notes": "Removed unused imports (asdict, VERIFY_FAILED, ClaudeCodeFormatter, TerminalFormatter, subprocess, sys)", "blocked_by": null},
      {"phase_name": "REFACTOR_L4", "phase_index": 6, "status": "SKIPPED", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": "NOT_APPLICABLE", "notes": "No architectural patterns needed - simple standalone script", "blocked_by": null},
      {"phase_name": "COMMIT", "phase_index": 7, "status": "PENDING", "started_at": null, "ended_at": null, "duration_minutes": null, "outcome": null, "notes": "Ready for commit", "blocked_by": null}
    ]
  },

  "quality_gates": {
    "test_coverage_minimum": 80,
    "all_acceptance_tests_pass": true,
    "no_linting_errors": true
  },

  "deliverables": {
    "files_created": [
      "scripts/install/verify_nwave.py",
      "tests/unit/test_verify_nwave.py"
    ],
    "tests_added": 21,
    "coverage": "100% of verify_nwave functions covered",
    "key_functions": [
      "parse_args() - Command line argument parsing",
      "run_verification() - Delegating to InstallationVerifier",
      "format_terminal_output() - Human-readable terminal output",
      "format_json_output() - Machine-parseable JSON output",
      "main() - Entry point with context-based output selection"
    ]
  }
}
