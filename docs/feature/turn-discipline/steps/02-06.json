{
  "task_specification": {
    "task_id": "02-06",
    "phase_id": "02",
    "name": "Scenario 008: Implement TIMEOUT_INSTRUCTION validation in PromptValidator",
    "description": "Extend PromptValidator to check for mandatory TIMEOUT_INSTRUCTION section. Validation must FAIL when section missing or incomplete. Return error message identifying TIMEOUT_INSTRUCTION as missing mandatory section.",
    "acceptance_test_scenario": "test_scenario_008_missing_timeout_instruction_blocks_invocation",
    "acceptance_criteria": [
      "GIVEN incomplete prompt missing TIMEOUT_INSTRUCTION",
      "WHEN pre-invocation validation runs",
      "THEN validation.is_valid == False AND error contains 'TIMEOUT_INSTRUCTION' AND error contains 'MISSING'"
    ],
    "requires": [
      "02-05"
    ],
    "estimated_hours": 3
  },
  "tdd_cycle": {
    "phases": [
      {
        "phase_number": 1,
        "phase_name": "PREPARE",
        "description": "Remove @skip tags, verify scenario setup",
        "checks": [
          "Acceptance test file located: tests/acceptance/test_us006_turn_discipline.py",
          "@skip tag removed from test_scenario_008",
          "PromptValidator implementation located and understood",
          "Validation mechanism reviewed"
        ]
      },
      {
        "phase_number": 2,
        "phase_name": "RED_ACCEPTANCE",
        "description": "Run acceptance test, expect FAIL",
        "checks": [
          "Test discovered: test_scenario_008_missing_timeout_instruction_blocks_invocation",
          "Test invokes validation with incomplete prompt",
          "Test fails: validation does not reject prompt or error message incorrect"
        ]
      },
      {
        "phase_number": 3,
        "phase_name": "RED_UNIT",
        "description": "Write failing unit tests",
        "checks": [
          "Unit test file created: tests/unit/test_timeout_instruction_validation.py",
          "Test: PromptValidator rejects prompt missing TIMEOUT_INSTRUCTION section",
          "Test: validation.is_valid == False when section missing",
          "Test: error message contains 'TIMEOUT_INSTRUCTION'",
          "Test: error message contains 'MISSING' or similar status",
          "Test: validation passes when TIMEOUT_INSTRUCTION present",
          "Test: validation checks all required elements (header, turn budget, checkpoints, early exit, logging)",
          "All tests fail (validation logic not yet implemented)"
        ]
      },
      {
        "phase_number": 4,
        "phase_name": "GREEN_UNIT",
        "description": "Implement minimum code to pass",
        "checks": [
          "Extend PromptValidator with TIMEOUT_INSTRUCTION section check",
          "Implement missing section detection",
          "Create validation error when section missing",
          "Generate error message: 'TIMEOUT_INSTRUCTION section MISSING'",
          "Implement completeness check: all required elements present",
          "Return is_valid=False on validation failure",
          "All unit tests PASS"
        ]
      },
      {
        "phase_number": 5,
        "phase_name": "CHECK_ACCEPTANCE",
        "description": "Verify unit implementation",
        "checks": [
          "Validation logic verified: rejects incomplete prompts",
          "Error message format verified: contains 'TIMEOUT_INSTRUCTION' and 'MISSING'",
          "Passing case verified: valid prompts pass validation",
          "Completeness check verified: all elements checked"
        ]
      },
      {
        "phase_number": 6,
        "phase_name": "GREEN_ACCEPTANCE",
        "description": "Run acceptance test, expect PASS",
        "checks": [
          "Acceptance test PASSES: invalid prompts rejected with correct error",
          "test_scenario_008_missing_timeout_instruction_blocks_invocation PASSES"
        ]
      },
      {
        "phase_number": 7,
        "phase_name": "REVIEW",
        "description": "Self-review (SOLID, coverage, acceptance criteria)",
        "checks": [
          "SOLID review: Single Responsibility - validation check focused on one concern",
          "Test coverage >80% for validation code",
          "Acceptance criteria met: is_valid=False and error message contains required keywords",
          "No security issues with validation",
          "Validation integrates with existing PromptValidator pattern"
        ]
      },
      {
        "phase_number": 8,
        "phase_name": "REFACTOR_L1",
        "description": "Naming clarity improvements",
        "checks": [
          "Validation method name clearly describes intent",
          "Error message is clear and actionable",
          "Boolean return value clear",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 9,
        "phase_name": "REFACTOR_L2",
        "description": "Method extraction",
        "checks": [
          "Validation logic extracted to clear helper method if complex",
          "Error message generation extracted if needed",
          "Completeness check extracted to separate method",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 10,
        "phase_name": "REFACTOR_L3",
        "description": "Class responsibilities",
        "checks": [
          "PromptValidator maintains clear single responsibility",
          "TIMEOUT_INSTRUCTION validation cohesive with existing validations",
          "No additional class extraction needed",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 11,
        "phase_name": "REFACTOR_L4",
        "description": "Architecture patterns",
        "checks": [
          "Validation follows existing validator pattern",
          "No new patterns needed",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 12,
        "phase_name": "POST_REFACTOR_REVIEW",
        "description": "Self-review (tests pass, quality improved)",
        "checks": [
          "All unit tests PASS",
          "Acceptance test PASSES",
          "Code quality maintained",
          "No regressions in previous validation tests"
        ]
      },
      {
        "phase_number": 13,
        "phase_name": "FINAL_VALIDATE",
        "description": "Full test suite validation",
        "checks": [
          "Full test suite executes: pytest tests/",
          "Coverage >=85% for validation code",
          "No new warnings or errors",
          "Scenarios 001-005 still pass"
        ]
      },
      {
        "phase_number": 14,
        "phase_name": "COMMIT",
        "description": "Commit with detailed message",
        "checks": [
          "Commit message format: 'feat(timeout-instruction-008): Implement TIMEOUT_INSTRUCTION validation in PromptValidator'",
          "All tests still pass",
          "Clean working directory"
        ]
      }
    ],
    "tdd_phase_tracking": {
      "current_phase": "PREPARE",
      "phase_execution_log": []
    }
  },
  "validation": {
    "status": "approved",
    "notes": "Feature step: Scenario 008 - TIMEOUT_INSTRUCTION validation enforcement",
    "approval_date": "2026-01-28T15:33:57.296549+00:00"
  }
}
