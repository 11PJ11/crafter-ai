{
  "task_specification": {
    "task_id": "03-01",
    "phase_id": "03",
    "name": "Scenario 009: Validate TIMEOUT_INSTRUCTION complete structure",
    "description": "Implement comprehensive validation that TIMEOUT_INSTRUCTION section contains all four required elements: turn budget (~50), progress checkpoints, early exit protocol, and turn logging instruction. Verify during prompt generation that all elements present before invocation allowed.",
    "acceptance_test_scenario": "test_scenario_009_timeout_instruction_has_complete_structure",
    "acceptance_criteria": [
      "GIVEN full prompt with TIMEOUT_INSTRUCTION",
      "WHEN prompt renders for /nw:execute",
      "THEN section contains 'TIMEOUT_INSTRUCTION' header AND '50' with 'turn' AND checkpoint markers (~10, ~25, ~40, turn 10, 25, 40) AND ('cannot complete' OR 'early exit' OR 'save progress' OR 'stuck') AND ('log' with 'turn' OR 'phase')"
    ],
    "requires": [
      "02-06"
    ],
    "estimated_hours": 2
  },
  "tdd_cycle": {
    "phases": [
      {
        "phase_number": 1,
        "phase_name": "PREPARE",
        "description": "Remove @skip tags, verify scenario setup",
        "checks": [
          "Acceptance test file located: tests/acceptance/test_us006_turn_discipline.py",
          "@skip tag removed from test_scenario_009",
          "All previous TIMEOUT_INSTRUCTION content verified in template",
          "Validation requirements identified: header, budget, checkpoints, early exit, logging"
        ]
      },
      {
        "phase_number": 2,
        "phase_name": "RED_ACCEPTANCE",
        "description": "Run acceptance test, expect FAIL",
        "checks": [
          "Test discovered: test_scenario_009_timeout_instruction_has_complete_structure",
          "Test invokes /nw:execute command",
          "Test fails: not all required elements verified in prompt"
        ]
      },
      {
        "phase_number": 3,
        "phase_name": "RED_UNIT",
        "description": "Write failing unit tests",
        "checks": [
          "Unit test file created: tests/unit/test_timeout_instruction_complete_structure.py",
          "Test: TIMEOUT_INSTRUCTION header present",
          "Test: Turn budget (~50 or '50 turn') present",
          "Test: Progress checkpoints present (~10, ~25, ~40)",
          "Test: Early exit protocol present (keywords verified)",
          "Test: Turn logging instruction present (keywords verified)",
          "Test: All five elements present simultaneously in section",
          "All tests fail (completeness validation not yet implemented)"
        ]
      },
      {
        "phase_number": 4,
        "phase_name": "GREEN_UNIT",
        "description": "Implement minimum code to pass",
        "checks": [
          "Extend validation to check for all five required elements",
          "Verify header: '## TIMEOUT_INSTRUCTION'",
          "Verify budget: contains '50' AND 'turn'",
          "Verify checkpoints: contains ~10, ~25, ~40 markers",
          "Verify early exit: contains required keywords",
          "Verify logging: contains required keywords",
          "All unit tests PASS"
        ]
      },
      {
        "phase_number": 5,
        "phase_name": "CHECK_ACCEPTANCE",
        "description": "Verify unit implementation",
        "checks": [
          "Completeness check logic verified",
          "All five elements detected correctly",
          "Elements verified in correct section (TIMEOUT_INSTRUCTION)",
          "Validation rejects incomplete sections"
        ]
      },
      {
        "phase_number": 6,
        "phase_name": "GREEN_ACCEPTANCE",
        "description": "Run acceptance test, expect PASS",
        "checks": [
          "Acceptance test PASSES: all elements detected in prompt",
          "test_scenario_009_timeout_instruction_has_complete_structure PASSES"
        ]
      },
      {
        "phase_number": 7,
        "phase_name": "REVIEW",
        "description": "Self-review (SOLID, coverage, acceptance criteria)",
        "checks": [
          "SOLID review: Validation has single responsibility",
          "Test coverage >80% for completeness checking",
          "Acceptance criteria met: all five elements verified",
          "No security issues",
          "Validation integrates with PromptValidator"
        ]
      },
      {
        "phase_number": 8,
        "phase_name": "REFACTOR_L1",
        "description": "Naming clarity improvements",
        "checks": [
          "Validation method name clearly describes completeness check",
          "Element names clear (header, budget, checkpoints, early_exit, logging)",
          "Error messages descriptive",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 9,
        "phase_name": "REFACTOR_L2",
        "description": "Method extraction",
        "checks": [
          "Element verification logic extracted to helper methods if needed",
          "Each element check focused on single concern",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 10,
        "phase_name": "REFACTOR_L3",
        "description": "Class responsibilities",
        "checks": [
          "Validation class maintains clear responsibility",
          "Completeness check cohesive with existing validations",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 11,
        "phase_name": "REFACTOR_L4",
        "description": "Architecture patterns",
        "checks": [
          "Validation follows existing patterns",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 12,
        "phase_name": "POST_REFACTOR_REVIEW",
        "description": "Self-review (tests pass, quality improved)",
        "checks": [
          "All unit tests PASS",
          "Acceptance test PASSES",
          "Code quality maintained",
          "No regressions"
        ]
      },
      {
        "phase_number": 13,
        "phase_name": "FINAL_VALIDATE",
        "description": "Full test suite validation",
        "checks": [
          "Full test suite executes: pytest tests/",
          "Coverage >=80%",
          "No new warnings or errors",
          "Scenarios 001-008 still pass"
        ]
      },
      {
        "phase_number": 14,
        "phase_name": "COMMIT",
        "description": "Commit with detailed message",
        "checks": [
          "Commit message format: 'feat(timeout-instruction-009): Validate TIMEOUT_INSTRUCTION complete structure'",
          "All tests still pass",
          "Clean working directory"
        ]
      }
    ],
    "tdd_phase_tracking": {
      "current_phase": "PREPARE",
      "phase_execution_log": []
    }
  },
  "validation": {
    "status": "approved",
    "notes": "Feature step: Scenario 009 - Content completeness validation",
    "approval_date": "2026-01-28T15:33:57.296549+00:00"
  }
}
