{
  "task_specification": {
    "task_id": "05-03",
    "phase_id": "05",
    "name": "Scenario 013: Emit timeout warnings at threshold crossings",
    "description": "Implement warning emission at 50% (20 min), 75% (30 min), 90% (36 min) elapsed time thresholds during phase execution. Warnings should include threshold value and elapsed time indication. Emit warnings as list in execute_step() result.",
    "acceptance_test_scenario": "test_scenario_013_timeout_warnings_emit_at_thresholds",
    "acceptance_criteria": [
      "GIVEN execute_step() with timeout_thresholds=[20, 30, 36], 40-minute budget",
      "WHEN execution crosses thresholds at 50%, 75%, 90%",
      "THEN result.warnings_emitted contains threshold warnings AND warnings include 'elapsed' indication"
    ],
    "requires": [
      "05-02"
    ],
    "estimated_hours": 3
  },
  "tdd_cycle": {
    "phases": [
      {
        "phase_number": 1,
        "phase_name": "PREPARE",
        "description": "Remove @skip tags, verify scenario setup",
        "checks": [
          "Acceptance test file located: tests/acceptance/test_us006_turn_discipline.py",
          "@skip tag removed from test_scenario_013",
          "TimeoutMonitor and orchestrator integration confirmed",
          "Warning emission mechanism identified"
        ]
      },
      {
        "phase_number": 2,
        "phase_name": "RED_ACCEPTANCE",
        "description": "Run acceptance test, expect FAIL",
        "checks": [
          "Test discovered: test_scenario_013_timeout_warnings_emit_at_thresholds",
          "Test simulates execution crossing thresholds",
          "Test fails: warnings not emitted or missing 'elapsed' indication"
        ]
      },
      {
        "phase_number": 3,
        "phase_name": "RED_UNIT",
        "description": "Write failing unit tests",
        "checks": [
          "Unit test file created: tests/unit/test_timeout_warning_emission.py",
          "Test: No warnings at start of execution",
          "Test: Warning emitted when 50% threshold crossed (20 min elapsed)",
          "Test: Warning emitted when 75% threshold crossed (30 min elapsed)",
          "Test: Warning emitted when 90% threshold crossed (36 min elapsed)",
          "Test: Each warning includes threshold value",
          "Test: Each warning includes 'elapsed' indication (minutes, time, duration, etc.)",
          "Test: Warnings returned in execute_step() result",
          "All tests fail (warning emission not yet implemented)"
        ]
      },
      {
        "phase_number": 4,
        "phase_name": "GREEN_UNIT",
        "description": "Implement minimum code to pass",
        "checks": [
          "Create warning emission logic in execute_step()",
          "Check TimeoutMonitor for threshold crossings periodically during execution",
          "Generate warning message when threshold crossed",
          "Format: 'TIMEOUT WARNING: 50% elapsed (20 minutes) - 20 minutes remaining' or similar",
          "Include threshold value and elapsed time in warning",
          "Store warnings in list",
          "Return warnings in execute_step() result",
          "All unit tests PASS"
        ]
      },
      {
        "phase_number": 5,
        "phase_name": "CHECK_ACCEPTANCE",
        "description": "Verify unit implementation",
        "checks": [
          "Warning emission logic verified: thresholds trigger warnings",
          "Warning format verified: includes threshold and elapsed time",
          "Warning collection verified: all thresholds emitted",
          "Result integration verified: warnings in execute_step() result"
        ]
      },
      {
        "phase_number": 6,
        "phase_name": "GREEN_ACCEPTANCE",
        "description": "Run acceptance test, expect PASS",
        "checks": [
          "Acceptance test PASSES: warnings emitted at thresholds with elapsed indication",
          "test_scenario_013_timeout_warnings_emit_at_thresholds PASSES"
        ]
      },
      {
        "phase_number": 7,
        "phase_name": "REVIEW",
        "description": "Self-review (SOLID, coverage, acceptance criteria)",
        "checks": [
          "SOLID review: Warning emission has single responsibility",
          "Test coverage >85% for warning logic",
          "Acceptance criteria met: warnings emitted with elapsed indication",
          "No security issues with warnings",
          "Warning format clear and actionable"
        ]
      },
      {
        "phase_number": 8,
        "phase_name": "REFACTOR_L1",
        "description": "Naming clarity improvements",
        "checks": [
          "Warning message format clear and consistent",
          "Variable names descriptive (warnings_emitted, threshold_crossed)",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 9,
        "phase_name": "REFACTOR_L2",
        "description": "Method extraction",
        "checks": [
          "Warning generation extracted to helper method",
          "Threshold checking logic extracted if complex",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 10,
        "phase_name": "REFACTOR_L3",
        "description": "Class responsibilities",
        "checks": [
          "Orchestrator maintains clear responsibility",
          "Warning emission cohesive with execution logic",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 11,
        "phase_name": "REFACTOR_L4",
        "description": "Architecture patterns",
        "checks": [
          "Follows existing warning pattern if one exists",
          "All tests still pass"
        ]
      },
      {
        "phase_number": 12,
        "phase_name": "POST_REFACTOR_REVIEW",
        "description": "Self-review (tests pass, quality improved)",
        "checks": [
          "All unit tests PASS",
          "Acceptance test PASSES",
          "Code quality maintained",
          "No regressions in orchestrator"
        ]
      },
      {
        "phase_number": 13,
        "phase_name": "FINAL_VALIDATE",
        "description": "Full test suite validation",
        "checks": [
          "Full test suite executes: pytest tests/",
          "Coverage >=85% for warning emission",
          "No new warnings or errors",
          "Scenarios 001-010, 006-007 still pass"
        ]
      },
      {
        "phase_number": 14,
        "phase_name": "COMMIT",
        "description": "Commit with detailed message",
        "checks": [
          "Commit message format: 'feat(timeout-warnings-013): Emit timeout warnings at threshold crossings'",
          "All tests still pass",
          "Clean working directory"
        ]
      }
    ],
    "tdd_phase_tracking": {
      "current_phase": "PREPARE",
      "phase_execution_log": []
    }
  },
  "validation": {
    "status": "approved",
    "notes": "Feature step: Scenario 013 - Timeout warning emission at thresholds",
    "approval_date": "2026-01-28T15:33:57.296549+00:00"
  }
}
