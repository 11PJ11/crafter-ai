{
  "task_specification": {
    "task_id": "01-08",
    "project_id": "des-us003",
    "step_type": "integration",
    "name": "Integration: Wire SubagentStopHook into DESOrchestrator",
    "description": "Make test_orchestrator_invokes_subagent_stop_hook_on_completion AND test_orchestrator_detects_abandoned_phase_via_entry_point pass (RED -> GREEN).\n\nThis is the INTEGRATION step required by CM-B countermeasure.\n\nImplements:\n- DESOrchestrator.on_subagent_complete() method\n- Invokes SubagentStopHook.validate() with step file path\n- Returns HookResult to caller\n- Wires validation into the actual entry point\n\nTest expectation (hook invocation):\n- Entry point calls hook after sub-agent completion\n- Hook receives correct step file path\n- HookResult returned through entry point\n\nTest expectation (abandoned detection via entry point):\n- Entry point detects abandoned phase\n- Returns FAILED validation_status\n- Proves end-to-end wiring works",
    "acceptance_test_scenario": "test_orchestrator_invokes_subagent_stop_hook_on_completion",
    "acceptance_test_file": "tests/acceptance/test_us003_post_execution_validation.py",
    "acceptance_criteria": "CM-B Integration Wiring",
    "suggested_agent": "software-crafter",
    "estimated_complexity": "medium",
    "requires": ["01-01", "01-02", "01-03", "01-04", "01-05", "01-06", "01-07"],
    "additional_scenarios": ["test_orchestrator_detects_abandoned_phase_via_entry_point"],
    "note": "This is the mandatory INTEGRATION step ensuring SubagentStopHook is wired into the actual entry point (DESOrchestrator), not just tested in isolation."
  },
  "state": {
    "status": "PENDING",
    "started_at": null,
    "completed_at": null
  },
  "tdd_cycle": {
    "acceptance_test": {
      "scenario_name": "test_orchestrator_invokes_subagent_stop_hook_on_completion",
      "test_file": "tests/acceptance/test_us003_post_execution_validation.py",
      "test_file_format": "py_pytest",
      "initially_ignored": true,
      "mapped_scenario": {
        "scenario_function": "test_orchestrator_invokes_subagent_stop_hook_on_completion",
        "scenario_description": "Verify DESOrchestrator entry point invokes SubagentStopHook after sub-agent completion",
        "mapping_type": "integration"
      },
      "additional_scenarios": [
        {
          "scenario_function": "test_orchestrator_detects_abandoned_phase_via_entry_point",
          "scenario_description": "Verify end-to-end detection of abandoned phases through the actual entry point",
          "mapping_type": "integration"
        }
      ]
    },
    "tdd_phase_tracking": {
      "current_phase": "NOT_STARTED",
      "phases_completed": []
    },
    "phase_execution_log": [
      {
        "phase_name": "PREPARE",
        "phase_index": 0,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "RED_ACCEPTANCE",
        "phase_index": 1,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "RED_UNIT",
        "phase_index": 2,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "GREEN_UNIT",
        "phase_index": 3,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "CHECK_ACCEPTANCE",
        "phase_index": 4,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "GREEN_ACCEPTANCE",
        "phase_index": 5,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "REVIEW",
        "phase_index": 6,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "REFACTOR_L1",
        "phase_index": 7,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "REFACTOR_L2",
        "phase_index": 8,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "REFACTOR_L3",
        "phase_index": 9,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "REFACTOR_L4",
        "phase_index": 10,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "POST_REFACTOR_REVIEW",
        "phase_index": 11,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "FINAL_VALIDATE",
        "phase_index": 12,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      },
      {
        "phase_name": "COMMIT",
        "phase_index": 13,
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "duration_minutes": null,
        "outcome": null,
        "outcome_details": null,
        "artifacts_created": [],
        "artifacts_modified": [],
        "test_results": {"total": null, "passed": null, "failed": null, "skipped": null},
        "notes": null,
        "blocked_by": null,
        "history": []
      }
    ]
  },
  "quality_gates": {
    "acceptance_test_must_fail_first": true,
    "unit_tests_must_fail_first": true,
    "all_14_phases_mandatory": true
  },
  "validation": {
    "status": "approved",
    "reviewed_by": "software-crafter-reviewer",
    "reviewed_at": "2026-01-24T12:00:00Z",
    "review_notes": "CM-B Integration Step validated: step_type is 'integration', acceptance test scenario maps to test_orchestrator_invokes_subagent_stop_hook_on_completion (line 862), additional_scenarios includes test_orchestrator_detects_abandoned_phase_via_entry_point (line 889), dependencies correctly include ALL prior steps (01-01 through 01-07), all 14 phases present with correct indices (0-13), quality gates defined. This step ensures SubagentStopHook is wired into DESOrchestrator entry point."
  }
}
