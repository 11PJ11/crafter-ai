{
  "task_id": "US005-03-04",
  "project_id": "des-us005",
  "task_specification": {
    "task_id": "US005-03-04",
    "title": "Integrate RecoveryGuidanceHandler with DES orchestrator",
    "description": "Wire RecoveryGuidanceHandler into DES orchestrator post-execution flow.\n\nIntegration Points:\n1. SubagentStop hook: Detects agent crash/completion\n2. Post-execution validation: Detects validation failures\n3. Step file update: Persists recovery suggestions\n\nWorkflow:\nSTEP 1: Agent returns (SubagentStop hook fires)\nSTEP 2: Check for failure indicators (abandoned phase, silent completion)\nSTEP 3: Extract failure context (phase name, transcript path)\nSTEP 4: RecoveryGuidanceHandler.handle_failure() generates suggestions\nSTEP 5: Update step file with status: FAILED and recovery_suggestions\nSTEP 6: Return control with recovery guidance displayed\n\nError Handling:\n- If suggestion generation fails, fall back to generic recovery guidance\n- Log suggestion generation errors for debugging\n- Ensure suggestions never block orchestrator progression",
    "acceptance_criteria": [
      "SubagentStop hook calls RecoveryGuidanceHandler",
      "Failure context properly extracted and passed",
      "Step file updated with recovery suggestions",
      "Recovery suggestions displayed to user",
      "No orchestrator crashes if suggestion generation fails",
      "Suggestions are available in step file for later review"
    ]
  },
  "schema_version": "2.0",
  "tdd_cycle": {
    "acceptance_test": {
      "scenario_name": "",
      "test_file": "",
      "test_file_format": "feature",
      "scenario_index": 0,
      "initially_ignored": true,
      "is_walking_skeleton": false,
      "mapped_scenario": {
        "description": "The specific acceptance test scenario this step makes pass",
        "scenario_function": "",
        "scenario_description": "",
        "mapping_type": "feature",
        "valid_mapping_types": [
          "feature",
          "infrastructure",
          "refactoring"
        ],
        "notes": ""
      }
    },
    "expected_unit_tests": [],
    "mock_boundaries": {
      "allowed_ports": [],
      "forbidden_domain_classes": [],
      "in_memory_adapters": []
    },
    "tdd_phase_tracking": {
      "current_phase": "NOT_STARTED",
      "active_e2e_test": "",
      "inactive_e2e_tests": "All other @skip scenarios remain disabled",
      "phases_completed": [],
      "test_results": {
        "total": null,
        "passed": null,
        "failed": null,
        "skipped": null
      }
    },
    "phase_execution_log": [
      {
        "phase_name": "PREPARE",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      },
      {
        "phase_name": "RED_ACCEPTANCE",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      },
      {
        "phase_name": "RED_UNIT",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      },
      {
        "phase_name": "GREEN",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      },
      {
        "phase_name": "REVIEW",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      },
      {
        "phase_name": "REFACTOR_CONTINUOUS",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      },
      {
        "phase_name": "REFACTOR_L4",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      },
      {
        "phase_name": "COMMIT",
        "status": "NOT_EXECUTED",
        "started_at": null,
        "ended_at": null,
        "outcome": null,
        "notes": null,
        "blocked_by": null
      }
    ]
  },
  "validation": {
    "status": "approved",
    "reviewed_by": "devop-orchestrator",
    "reviewed_at": "2026-01-28T22:40:00Z",
    "reviewer_agent": "software-crafter-reviewer",
    "attempt": 1,
    "notes": "Step file structure verified. Schema v2.0 compliant. Ready for execution."
  }
}
