{
  "project_id": "plugin-marketplace-migration",
  "step_id": "05-01",
  "correction_version": "2.0-circular-dependency-fix",
  "correction_date": "2026-01-06",
  "correction_rationale": "Original step has CONDITIONAL_APPROVAL but is prerequisite for 05-04 validation. Circular dependency: cannot validate before implementation proven. Solution: Split into two sub-steps with clear prerequisite resolution phase.",

  "phase": {
    "number": 5,
    "name": "Skills Creation",
    "purpose": "Create 3 skill definitions for auto-invocation capability"
  },

  "step": {
    "number": "5.1",
    "name": "Create develop Skill (with Prerequisites Resolution)",
    "description": "PHASE A: Resolve TOON skill format blockers\nPHASE B: Create develop skill implementation\n\nPHASE A - BLOCKING PREREQUISITES:\n1. Obtain TOON v3.0 skill syntax specification\n2. Document skill invocation mechanism\n3. Define constraint embedding format\n4. Create SKILL_TEMPLATE.toon example\n5. Set up test environment for skill triggering\n\nPHASE B - IMPLEMENTATION:\n- Trigger patterns: \"implementa\", \"scrivi codice\", \"TDD\", \"implement\", \"write code\"\n- Agent binding: software-crafter\n- Full workflow integration (implement->review->fix->refactor)\n- Default constraints embedded (no auto-report, no auto-commit)",
    "motivation": "develop skill is the primary inner loop automation. Prerequisites must be resolved BEFORE implementation to prevent circular dependency with validation step 05-04.",
    "estimated_hours": "6-8 (4 hours prerequisites + 2-4 hours implementation)"
  },

  "context": {
    "constraints": [
      "DO NOT START PHASE B UNTIL PHASE A COMPLETE",
      "DO NOT CREATE NEW REPORT FILES",
      "DO NOT COMMIT BEFORE USER APPROVAL",
      "FOCUS ON DELIVERABLES ONLY",
      "Tests use business language and domain concepts",
      "Type system makes wrong state non-representable"
    ],
    "success_criteria_mapping": {
      "SC4": "Skills auto-invoked correctly (depends on Phase A completion)",
      "SC5": "Full workflow (implement->review->fix->refactor) functional",
      "SC6": "Default constraints integrated (no auto-report, no auto-commit)"
    },
    "dependencies": ["1.6"],
    "blocking_prerequisites": [
      "TOON v3.0 skill syntax specification documented",
      "Skill invocation mechanism explained",
      "Constraint embedding format defined",
      "SKILL_TEMPLATE.toon created as reference",
      "Test environment for E2E skill triggering available"
    ]
  },

  "deliverables": {
    "phase_a_deliverables": [
      "docs/toon-v3-skill-syntax-specification.md",
      "docs/skill-invocation-mechanism.md",
      "docs/constraint-embedding-format.md",
      "5d-wave/templates/SKILL_TEMPLATE.toon",
      "tests/skills/skill_test_environment_setup.md"
    ],
    "phase_b_deliverables": [
      "5d-wave/skills/develop/SKILL.toon",
      "5d-wave/skills/develop/SKILL.md (compiled output)"
    ],
    "acceptance_criteria": [
      "PHASE A: All 5 prerequisite documents created and reviewed",
      "PHASE A: SKILL_TEMPLATE.toon compiles successfully to SKILL.md",
      "PHASE A: Test environment can simulate skill triggering",
      "PHASE B: develop SKILL.toon compiles to valid SKILL.md",
      "PHASE B: Trigger patterns include Italian and English",
      "PHASE B: Agent binding to software-crafter correct",
      "PHASE B: Workflow steps defined (implement, review, fix, refactor)",
      "PHASE B: Default constraints embedded in skill"
    ]
  },

  "tdd_approach": {
    "outer_test": "GIVEN PHASE A complete AND develop SKILL.toon compiled\nWHEN user says \"implementa questa feature\"\nTHEN skill should trigger software-crafter with develop workflow",
    "inner_tests": [
      "test_phase_a_toon_syntax_documented",
      "test_phase_a_invocation_mechanism_documented",
      "test_phase_a_skill_template_compiles",
      "test_phase_b_skill_compiles",
      "test_phase_b_trigger_patterns_multilingual",
      "test_phase_b_agent_binding",
      "test_phase_b_workflow_steps_present",
      "test_phase_b_constraints_embedded"
    ]
  },

  "refactoring": {
    "targets": [
      {
        "level": 2,
        "focus": "Workflow step extraction"
      }
    ]
  },

  "execution_guidance": {
    "approach": "Two-Phase Execution: Prerequisites Resolution then Implementation",
    "phase_a_workflow": [
      "1. Research TOON v3.0 skill syntax (review parser code, templates, examples)",
      "2. Document skill syntax specification with concrete examples",
      "3. Research skill invocation mechanism (Claude Code integration, MCP protocol)",
      "4. Document invocation mechanism with test simulation approach",
      "5. Define constraint embedding format (YAML metadata? Comments? Structured section?)",
      "6. Create SKILL_TEMPLATE.toon demonstrating all features",
      "7. Compile template and validate output SKILL.md",
      "8. Set up test environment (simulator or mock invocation framework)",
      "9. CHECKPOINT: Review all Phase A deliverables before proceeding"
    ],
    "phase_b_workflow": [
      "1. Copy SKILL_TEMPLATE.toon to 5d-wave/skills/develop/SKILL.toon",
      "2. Customize trigger patterns for develop skill",
      "3. Define workflow steps (implement->review->fix->refactor)",
      "4. Embed default constraints using Phase A format",
      "5. Compile SKILL.toon to SKILL.md",
      "6. Write E2E test for skill triggering",
      "7. Validate all acceptance criteria",
      "8. Apply refactoring level 2",
      "9. DO NOT COMMIT - wait for user approval"
    ],
    "quality_gates": [
      "PHASE A: All prerequisite documentation complete",
      "PHASE A: SKILL_TEMPLATE.toon compiles successfully",
      "PHASE A: Test environment functional",
      "PHASE B: All tests passing (100% required)",
      "PHASE B: Skill compiles to valid SKILL.md",
      "PHASE B: Trigger patterns validated",
      "PHASE B: Workflow steps complete",
      "PHASE B: Constraints embedded",
      "PHASE B: Refactoring applied (level 2)",
      "PHASE B: No report files created"
    ]
  },

  "approval_status": {
    "status": "CORRECTED_PENDING_REVIEW",
    "changes_from_original": [
      "Split into two phases (Prerequisites + Implementation)",
      "Phase A explicitly resolves all CONDITIONAL_APPROVAL blockers",
      "Time estimate revised from 2h to 6-8h (realistic)",
      "Added prerequisite deliverables (5 documentation artifacts)",
      "Added checkpoint between phases",
      "Clarified that 05-04 cannot run until Phase B complete AND proven"
    ],
    "dependency_chain_fixed": "05-01 Phase A -> 05-01 Phase B -> 05-02/05-03 (parallel) -> 05-04 validation",
    "circular_dependency_resolution": "05-04 now depends on 05-01/05-02/05-03 FULL COMPLETION (not conditional approval). Phase A removes all unknowns before implementation."
  }
}
