# Baseline Measurement: nWave Versioning and Release Management
# Created: 2026-01-28
# Author: Nova (researcher)
# Type: Feature Development Baseline

metadata:
  feature: nWave Versioning and Release Management
  project_id: versioning-release-management
  baseline_type: feature_development
  development_type: greenfield
  created_at: "2026-01-28T00:00:00Z"
  wave: DEVELOP

# ============================================================================
# ACCEPTANCE TEST BASELINE
# ============================================================================
# Source: docs/features/versioning-release-management/distill/acceptance-tests.feature

acceptance_tests:
  total_scenarios: 35
  active_scenarios: 5
  skipped_scenarios: 30
  passing_scenarios: 0
  source_file: docs/features/versioning-release-management/distill/acceptance-tests.feature

  by_user_story:
    us-001:
      title: Check Installed Version
      command: /nw:version
      total_scenarios: 7
      active_scenarios: 1
      skipped_scenarios: 6
      passing_scenarios: 0
      scenarios:
        - name: Display version with update available
          status: active
          line: 32
        - name: Display version when up-to-date
          status: skipped
          line: 42
        - name: Display version when offline
          status: skipped
          line: 50
        - name: Daily auto-check updates watermark when stale
          status: skipped
          line: 60
        - name: Skip update check when watermark is fresh
          status: skipped
          line: 70
        - name: Handle missing VERSION file gracefully
          status: skipped
          line: 79
        - name: Handle GitHub API rate limit gracefully
          status: skipped
          line: 87

    us-002:
      title: Update nWave to Latest Release
      command: /nw:update
      total_scenarios: 10
      active_scenarios: 1
      skipped_scenarios: 9
      passing_scenarios: 0
      scenarios:
        - name: Successful update with backup creation
          status: active
          line: 112
        - name: Major version change requires confirmation
          status: skipped
          line: 126
        - name: Major version update proceeds with confirmation
          status: skipped
          line: 135
        - name: Major version update cancelled with denial
          status: skipped
          line: 145
        - name: Local RC version triggers customization warning
          status: skipped
          line: 155
        - name: Network failure during download leaves installation unchanged
          status: skipped
          line: 165
        - name: Checksum validation failure aborts update
          status: skipped
          line: 177
        - name: Backup rotation maintains exactly 3 copies
          status: skipped
          line: 188
        - name: Non-nWave user content is preserved during update
          status: skipped
          line: 202
        - name: Already up-to-date shows message without update
          status: skipped
          line: 217

    us-003:
      title: Build Custom Local Distribution
      command: /nw:forge
      total_scenarios: 7
      active_scenarios: 1
      skipped_scenarios: 6
      passing_scenarios: 0
      scenarios:
        - name: Successful build with install prompt on main branch
          status: active
          line: 242
        - name: Build fails when tests fail
          status: skipped
          line: 256
        - name: RC counter increments on same day builds
          status: skipped
          line: 268
        - name: RC counter resets on new day
          status: skipped
          line: 280
        - name: Feature branch name included in RC version
          status: skipped
          line: 291
        - name: User declines install after successful build
          status: skipped
          line: 302
        - name: User accepts install after successful build
          status: skipped
          line: 312

    us-004:
      title: Install Built Distribution
      command: /nw:forge:install
      total_scenarios: 5
      active_scenarios: 1
      skipped_scenarios: 4
      passing_scenarios: 0
      scenarios:
        - name: Successful installation with smoke test
          status: active
          line: 339
        - name: Installation preserves non-nWave user content
          status: skipped
          line: 351
        - name: Installation fails when dist/ directory does not exist
          status: skipped
          line: 360
        - name: Installation fails when dist/ is missing required files
          status: skipped
          line: 368
        - name: Smoke test failure reports error
          status: skipped
          line: 377

    us-005:
      title: Create Official Release
      command: /nw:forge:release
      total_scenarios: 6
      active_scenarios: 1
      skipped_scenarios: 5
      passing_scenarios: 0
      scenarios:
        - name: Successful release PR creation from development branch
          status: active
          line: 402
        - name: Release command fails on main branch
          status: skipped
          line: 412
        - name: Release command fails on feature branch
          status: skipped
          line: 420
        - name: Permission denied for non-admin user
          status: skipped
          line: 428
        - name: Release fails with uncommitted changes
          status: skipped
          line: 437
        - name: Release shows pipeline status after PR creation
          status: skipped
          line: 448

# ============================================================================
# COMPONENT IMPLEMENTATION BASELINE
# ============================================================================
# Source: docs/features/versioning-release-management/architecture.md

components:
  total_to_implement: 20
  implemented: 0
  reusable_existing: 6

  # Hexagonal Architecture Components
  domain_model:
    count: 5
    implemented: 0
    components:
      - name: Version
        type: entity
        description: Semantic version comparison, format validation
        status: not_started
      - name: RCVersion
        type: value_object
        description: "RC version format: {base}-rc.{branch}.{YYYYMMDD}.{N}"
        status: not_started
      - name: Watermark
        type: entity
        description: Update check state - last_check, latest_version
        status: not_started
      - name: BackupPolicy
        type: domain_service
        description: Rolling retention rules (max 3 backups)
        status: not_started
      - name: CoreContentIdentifier
        type: domain_service
        description: Identifies nw-prefixed vs user content
        status: not_started

  application_services:
    count: 4
    implemented: 0
    components:
      - name: VersionService
        type: application_service
        description: Orchestrates version check, watermark management
        user_stories: [us-001]
        status: not_started
      - name: UpdateService
        type: application_service
        description: Orchestrates download, validation, backup, installation
        user_stories: [us-002]
        status: not_started
      - name: BuildService
        type: application_service
        description: Orchestrates test execution, RC version generation, dist creation
        user_stories: [us-003, us-004]
        status: not_started
      - name: ReleaseService
        type: application_service
        description: Orchestrates PR creation, pipeline triggering
        user_stories: [us-005]
        status: not_started

  driven_ports:
    count: 5
    implemented: 0
    components:
      - name: GitHubAPIPort
        type: port_interface
        description: HTTP calls to GitHub API for release metadata
        status: not_started
      - name: FileSystemPort
        type: port_interface
        description: Read/write ~/.claude/, backup creation
        status: not_started
      - name: GitPort
        type: port_interface
        description: Branch operations, tag creation, commit info
        status: not_started
      - name: DownloadPort
        type: port_interface
        description: Fetch release assets
        status: not_started
      - name: ChecksumPort
        type: port_interface
        description: SHA256 validation
        status: not_started

  adapters:
    count: 6
    implemented: 0
    components:
      - name: GitHubAPIAdapter
        type: driven_adapter
        description: Implementation of GitHubAPIPort using requests
        status: not_started
      - name: FileSystemAdapter
        type: driven_adapter
        description: Implementation of FileSystemPort using pathlib
        status: not_started
      - name: GitAdapter
        type: driven_adapter
        description: Implementation of GitPort using subprocess
        status: not_started
      - name: DownloadAdapter
        type: driven_adapter
        description: Implementation of DownloadPort using requests
        status: not_started
      - name: ChecksumAdapter
        type: driven_adapter
        description: Implementation of ChecksumPort using hashlib
        status: not_started
      - name: GitHubCLIAdapter
        type: driven_adapter
        description: Implementation for gh CLI operations
        status: not_started

  cli_entry_points:
    count: 5
    implemented: 0
    components:
      - name: version_cli
        type: driving_adapter
        description: CLI entry point for /nw:version
        user_story: us-001
        status: not_started
      - name: update_cli
        type: driving_adapter
        description: CLI entry point for /nw:update
        user_story: us-002
        status: not_started
      - name: forge_cli
        type: driving_adapter
        description: CLI entry point for /nw:forge
        user_story: us-003
        status: not_started
      - name: forge_install_cli
        type: driving_adapter
        description: CLI entry point for /nw:forge:install
        user_story: us-004
        status: not_started
      - name: forge_release_cli
        type: driving_adapter
        description: CLI entry point for /nw:forge:release
        user_story: us-005
        status: not_started

  # Existing components to reuse/extend (per ADR-006)
  existing_to_reuse:
    count: 6
    components:
      - name: VersionComparator
        location: nWave/core/version_management/version_comparator.py
        reuse: Extend for Version entity
      - name: ChangelogParser
        location: nWave/core/version_management/changelog_parser.py
        reuse: Integrate with UpdateService
      - name: BackupManager
        location: nWave/infrastructure/backup_manager.py
        reuse: Extend for BackupPolicy domain service
      - name: PathUtils
        location: scripts/install/install_utils.py
        reuse: Use for directory resolution
      - name: Logger/Colors
        location: scripts/install/install_utils.py
        reuse: Use for CLI output formatting
      - name: IDEBundleBuilder
        location: tools/core/build_ide_bundle.py
        reuse: Integrate with BuildService

# ============================================================================
# ARTIFACTS BASELINE
# ============================================================================

artifacts:
  requirements:
    location: docs/features/versioning-release-management/requirements.md
    status: complete
    wave: DISCUSS

  architecture:
    location: docs/features/versioning-release-management/architecture.md
    status: complete
    wave: DESIGN

  platform_design:
    location: docs/design/versioning-release-management/
    status: complete
    wave: DESIGN
    files:
      - cicd-pipeline.md
      - deployment-strategy.md
      - observability.md
      - adrs/ADR-PLAT-001-pure-python-dependencies.md
      - adrs/ADR-PLAT-002-github-api-rate-limit-handling.md
      - adrs/ADR-PLAT-003-branch-protection-workflow.md

  acceptance_tests:
    location: docs/features/versioning-release-management/distill/acceptance-tests.feature
    status: complete
    wave: DISTILL

# ============================================================================
# SUCCESS CRITERIA
# ============================================================================

success_criteria:
  acceptance_tests:
    target: 35
    current: 0
    metric: scenarios_passing

  components:
    target: 20
    current: 0
    metric: components_implemented

  coverage:
    target: 100%
    current: 0%
    metric: user_story_coverage

# ============================================================================
# IMPLEMENTATION STRATEGY
# ============================================================================

implementation_strategy:
  approach: one_scenario_at_a_time
  order:
    - phase: 1
      focus: Domain Model foundation
      components: [Version, RCVersion, Watermark, BackupPolicy, CoreContentIdentifier]
      rationale: Pure domain logic with no external dependencies

    - phase: 2
      focus: Port interfaces
      components: [GitHubAPIPort, FileSystemPort, GitPort, DownloadPort, ChecksumPort]
      rationale: Define contracts before implementing adapters

    - phase: 3
      focus: US-001 (Version Check)
      components: [VersionService, GitHubAPIAdapter, FileSystemAdapter, version_cli]
      target_scenarios: 7

    - phase: 4
      focus: US-002 (Update)
      components: [UpdateService, DownloadAdapter, ChecksumAdapter, update_cli]
      target_scenarios: 10

    - phase: 5
      focus: US-003 (Forge)
      components: [BuildService, GitAdapter, forge_cli]
      target_scenarios: 7

    - phase: 6
      focus: US-004 (Forge Install)
      components: [forge_install_cli]
      target_scenarios: 5

    - phase: 7
      focus: US-005 (Forge Release)
      components: [ReleaseService, GitHubCLIAdapter, forge_release_cli]
      target_scenarios: 6

# ============================================================================
# NOTES
# ============================================================================

notes:
  - "Greenfield development: all commands are new, no existing implementation to migrate"
  - "Hexagonal architecture enforces testability: all tests through CLI entry points only"
  - "Pure Python implementation per ADR-PLAT-001: requests, hashlib, pathlib, tarfile"
  - "5 active scenarios = 5 parallel entry points for initial development"
  - "Each user story has exactly 1 active scenario to unblock development"
  - "Existing utilities (VersionComparator, BackupManager) to be wrapped in adapters"

# ============================================================================
# VALIDATION
# ============================================================================
# Reviewer: software-crafter-reviewer (Crafty)
# Review Date: 2026-01-28

validation:
  status: APPROVED
  reviewer: software-crafter-reviewer
  review_date: "2026-01-28T00:00:00Z"
  revision: 2

  acceptance_test_validation:
    status: PASSED
    findings:
      - "Total scenario count: 35 - VERIFIED against acceptance-tests.feature"
      - "Active scenarios: 5 (1 per user story) - VERIFIED"
      - "Skipped scenarios: 30 - VERIFIED"
      - "Line numbers spot-checked against feature file - ALL MATCH"
    evidence:
      - "US-001: 7 scenarios (lines 32, 42, 50, 60, 70, 79, 87)"
      - "US-002: 10 scenarios (lines 112, 126, 135, 145, 155, 165, 177, 188, 202, 217)"
      - "US-003: 7 scenarios (lines 242, 256, 268, 280, 291, 302, 312)"
      - "US-004: 5 scenarios (lines 339, 351, 360, 368, 377)"
      - "US-005: 6 scenarios (lines 402, 412, 420, 428, 437, 448)"

  component_count_validation:
    status: PASSED
    findings:
      - "Domain Model count: 5 - VERIFIED against architecture.md"
      - "Application Services count: 4 - VERIFIED"
      - "Driven Ports count: 5 - VERIFIED (interfaces, not counted in implementation total)"
      - "Adapters count: 6 - VERIFIED"
      - "CLI Entry Points count: 5 - VERIFIED"
      - "Reusable existing count: 6 - VERIFIED against ADR-006"
    verification:
      calculation: "Domain(5) + AppServices(4) + Adapters(6) + CLI(5) = 20"
      total_to_implement: 20
      success_criteria_target: 20
      status: "MATCH - Component count discrepancy RESOLVED in revision 2"

  implementation_strategy_validation:
    status: PASSED
    findings:
      - "Phase 1 (Domain Model first) - SOUND: Pure domain logic with no external dependencies"
      - "Phase 2 (Port interfaces) - SOUND: Define contracts before implementing adapters"
      - "Phases 3-7 (Vertical slices per user story) - SOUND: Aligns with hexagonal architecture"
      - "One-scenario-at-a-time approach - SOUND: Prevents commit blocks per TDD best practice"

  success_criteria_validation:
    status: PASSED
    findings:
      - "Acceptance tests target (35) - MEASURABLE and matches feature file"
      - "User story coverage (100%) - MEASURABLE via scenario mapping"
      - "Components target (20) - VERIFIED matches total_to_implement"

  artifacts_validation:
    status: PASSED
    findings:
      - "Requirements artifact exists: docs/features/versioning-release-management/requirements.md"
      - "Architecture artifact exists: docs/features/versioning-release-management/architecture.md"
      - "Acceptance tests artifact exists: docs/features/versioning-release-management/distill/acceptance-tests.feature"

  overall_assessment:
    quality_score: 0.95
    strengths:
      - "Comprehensive acceptance test coverage with accurate scenario counts"
      - "Line numbers precisely match feature file - excellent traceability"
      - "Sound implementation strategy following hexagonal architecture principles"
      - "Clear one-scenario-at-a-time TDD approach"
      - "Reusable components properly identified from existing codebase"
      - "Component count accurately reflects hexagonal architecture (ports as interfaces, not implementations)"
    issues_resolved:
      - revision: 2
        issue: "Component count discrepancy: total_to_implement was 17, should be 20"
        resolution: "Corrected total_to_implement to 20 and success_criteria.components.target to 20"
        status: VERIFIED
    approval_status: APPROVED
    approval_note: |
      Baseline is ready for DEVELOP wave execution.
      All metrics are accurate, measurable, and aligned with architecture documentation.
      Component breakdown correctly excludes port interfaces (contracts) from implementation count.
