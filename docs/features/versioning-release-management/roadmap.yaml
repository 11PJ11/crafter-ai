# Roadmap: nWave Versioning and Release Management
# Created: 2026-01-28
# Author: Morgan (solution-architect)
# Based on: baseline.yaml (APPROVED 2026-01-28)
#
# Principle: 1 Scenario = 1 Step = 1 TDD Cycle
# Total Scenarios: 35 (5 active, 30 skipped)
# Total Steps: 45 (5 domain foundation + 5 port definitions + 35 scenario implementations)

project_id: versioning-release-management
created_at: "2026-01-28T00:00:00Z"
feature_description: "nWave Versioning and Release Management"
baseline_reference: docs/features/versioning-release-management/baseline.yaml

# ============================================================================
# PHASE 1: Domain Model Foundation
# ============================================================================
# Rationale: Pure domain logic with no external dependencies
# These components are prerequisites for all user story implementations

phases:
  - phase_id: "01"
    name: Domain Model Foundation
    focus: Pure domain logic with no external dependencies
    rationale: Domain entities and value objects form the foundation for all business logic
    steps:
      - step_id: "01-01"
        name: Implement Version entity
        description: |
          Semantic version comparison and format validation.
          - Parse version strings (major.minor.patch)
          - Compare versions for update detection
          - Handle pre-release versions (RC format)
        type: domain_model
        components:
          - name: Version
            type: entity
            location: nWave/core/versioning/domain/version.py
        dependencies: []
        acceptance_criteria:
          - Version("1.3.0") > Version("1.2.3") returns True
          - Version("1.2.3-rc.main.20260127.1").is_prerelease returns True
          - Invalid version strings raise ValueError

      - step_id: "01-02"
        name: Implement RCVersion value object
        description: |
          RC version format: {base}-rc.{branch}.{YYYYMMDD}.{N}
          - Parse and format RC version strings
          - Extract branch name, date, and build number
          - Increment build counter for same-day builds
        type: domain_model
        components:
          - name: RCVersion
            type: value_object
            location: nWave/core/versioning/domain/rc_version.py
        dependencies:
          - "01-01"
        acceptance_criteria:
          - RCVersion.create("1.2.3", "main", date(2026,1,27), 1) == "1.2.3-rc.main.20260127.1"
          - RCVersion.parse("1.2.3-rc.feature-new-agent.20260127.2").build_number == 2
          - Branch names with "/" are normalized to "-"

      - step_id: "01-03"
        name: Implement Watermark entity
        description: |
          Update check state tracking: last_check timestamp and latest_version.
          - Determine if check is stale (>24 hours)
          - Store and retrieve watermark state
        type: domain_model
        components:
          - name: Watermark
            type: entity
            location: nWave/core/versioning/domain/watermark.py
        dependencies:
          - "01-01"
        acceptance_criteria:
          - Watermark with last_check >24h ago is_stale returns True
          - Watermark with last_check <24h ago is_stale returns False
          - Watermark serializes to/from JSON

      - step_id: "01-04"
        name: Implement BackupPolicy domain service
        description: |
          Rolling retention rules: maximum 3 backups.
          - Determine which backups to delete
          - Generate backup directory names with timestamps
        type: domain_model
        components:
          - name: BackupPolicy
            type: domain_service
            location: nWave/core/versioning/domain/backup_policy.py
        dependencies: []
        acceptance_criteria:
          - With 3 existing backups, returns oldest for deletion
          - Generates backup path as ~/.claude.backup.{YYYYMMDDHHMMSS}/
          - With 0-2 existing backups, returns empty deletion list

      - step_id: "01-05"
        name: Implement CoreContentIdentifier domain service
        description: |
          Identifies nWave-prefixed vs user content in ~/.claude/.
          - Directories starting with "nw/" are core content
          - User content is preserved during updates
        type: domain_model
        components:
          - name: CoreContentIdentifier
            type: domain_service
            location: nWave/core/versioning/domain/core_content_identifier.py
        dependencies: []
        acceptance_criteria:
          - "~/.claude/agents/nw/... is_core_content returns True"
          - "~/.claude/agents/my-custom-agent/... is_core_content returns False"
          - "~/.claude/commands/nw/... is_core_content returns True"

  # ============================================================================
  # PHASE 2: Port Interfaces
  # ============================================================================
  # Rationale: Define contracts before implementing adapters

  - phase_id: "02"
    name: Port Interface Definitions
    focus: Define contracts before implementing adapters
    rationale: Hexagonal architecture requires port interfaces to be defined before adapters
    steps:
      - step_id: "02-01"
        name: Define GitHubAPIPort interface
        description: |
          HTTP calls to GitHub API for release metadata.
          - Get latest release version and checksum
          - Handle rate limiting and network errors
        type: port_interface
        components:
          - name: GitHubAPIPort
            type: port_interface
            location: nWave/core/versioning/ports/github_api_port.py
        dependencies:
          - "01-01"
        acceptance_criteria:
          - Abstract method get_latest_release() defined
          - Return type includes version, checksum, download_url
          - NetworkError and RateLimitError exception types defined

      - step_id: "02-02"
        name: Define FileSystemPort interface
        description: |
          Read/write ~/.claude/ directory operations.
          - Read VERSION file
          - Read/write watermark file
          - Create and manage backup directories
        type: port_interface
        components:
          - name: FileSystemPort
            type: port_interface
            location: nWave/core/versioning/ports/file_system_port.py
        dependencies:
          - "01-03"
          - "01-04"
        acceptance_criteria:
          - Abstract methods for read_version(), read_watermark(), write_watermark()
          - Abstract methods for create_backup(), list_backups(), delete_backup()
          - FileNotFoundError and PermissionError handling defined

      - step_id: "02-03"
        name: Define GitPort interface
        description: |
          Git operations for branch info and commit state.
          - Get current branch name
          - Check for uncommitted changes
          - Get repository root directory
        type: port_interface
        components:
          - name: GitPort
            type: port_interface
            location: nWave/core/versioning/ports/git_port.py
        dependencies: []
        acceptance_criteria:
          - Abstract methods get_current_branch(), has_uncommitted_changes()
          - Abstract method get_repo_root()
          - GitError exception type defined

      - step_id: "02-04"
        name: Define DownloadPort interface
        description: |
          Fetch release assets from remote server.
          - Download file to temporary location
          - Stream large files efficiently
        type: port_interface
        components:
          - name: DownloadPort
            type: port_interface
            location: nWave/core/versioning/ports/download_port.py
        dependencies: []
        acceptance_criteria:
          - Abstract method download(url, destination) defined
          - NetworkError exception type defined
          - Supports progress callback for large files

      - step_id: "02-05"
        name: Define ChecksumPort interface
        description: |
          SHA256 validation for downloaded files.
          - Calculate checksum of file
          - Verify checksum matches expected
        type: port_interface
        components:
          - name: ChecksumPort
            type: port_interface
            location: nWave/core/versioning/ports/checksum_port.py
        dependencies: []
        acceptance_criteria:
          - Abstract method calculate_sha256(file_path) defined
          - Abstract method verify(file_path, expected_checksum) defined
          - ChecksumMismatchError exception type defined

  # ============================================================================
  # PHASE 3: US-001 (Version Check)
  # ============================================================================
  # User Story: Check Installed Version (/nw:version)
  # 7 scenarios total

  - phase_id: "03"
    name: "US-001: Version Check"
    focus: Check Installed Version (/nw:version)
    rationale: Foundation command enabling update awareness
    target_scenarios: 7
    steps:
      - step_id: "03-01"
        name: "Display version with update available"
        description: |
          ACTIVE SCENARIO - First implementation
          Marco has v1.2.3, GitHub shows v1.3.0 available.
          Display version with update indicator, update watermark.
        type: scenario_implementation
        acceptance_scenario: "Display version with update available"
        acceptance_test_line: 32
        components:
          - name: VersionService
            type: application_service
            location: nWave/core/versioning/application/version_service.py
          - name: GitHubAPIAdapter
            type: driven_adapter
            location: nWave/infrastructure/versioning/github_api_adapter.py
          - name: FileSystemAdapter
            type: driven_adapter
            location: nWave/infrastructure/versioning/file_system_adapter.py
          - name: version_cli
            type: driving_adapter
            location: nWave/cli/version_cli.py
        dependencies:
          - "01-01"
          - "01-03"
          - "02-01"
          - "02-02"

      - step_id: "03-02"
        name: "Display version when up-to-date"
        description: |
          Sofia has v1.3.0, GitHub shows v1.3.0.
          Display version with "up to date" indicator.
        type: scenario_implementation
        acceptance_scenario: "Display version when up-to-date"
        acceptance_test_line: 42
        components: []
        dependencies:
          - "03-01"

      - step_id: "03-03"
        name: "Display version when offline"
        description: |
          Luca has v1.2.3, network is unavailable.
          Display version with "Unable to check" message, exit code 0.
        type: scenario_implementation
        acceptance_scenario: "Display version when offline"
        acceptance_test_line: 50
        components: []
        dependencies:
          - "03-01"

      - step_id: "03-04"
        name: "Daily auto-check updates watermark when stale"
        description: |
          Elena's watermark is 25 hours old.
          System checks GitHub, updates watermark with new timestamp.
        type: scenario_implementation
        acceptance_scenario: "Daily auto-check updates watermark when stale"
        acceptance_test_line: 60
        components: []
        dependencies:
          - "03-01"

      - step_id: "03-05"
        name: "Skip update check when watermark is fresh"
        description: |
          Marco's watermark is 1 hour old.
          No GitHub API call, use cached latest_version from watermark.
        type: scenario_implementation
        acceptance_scenario: "Skip update check when watermark is fresh"
        acceptance_test_line: 70
        components: []
        dependencies:
          - "03-04"

      - step_id: "03-06"
        name: "Handle missing VERSION file gracefully"
        description: |
          VERSION file does not exist.
          Display error, non-zero exit code.
        type: scenario_implementation
        acceptance_scenario: "Handle missing VERSION file gracefully"
        acceptance_test_line: 79
        components: []
        dependencies:
          - "03-01"

      - step_id: "03-07"
        name: "Handle GitHub API rate limit gracefully"
        description: |
          GitHub API returns HTTP 403 rate limit.
          Display version with "Unable to check" message, no error thrown.
        type: scenario_implementation
        acceptance_scenario: "Handle GitHub API rate limit gracefully"
        acceptance_test_line: 87
        components: []
        dependencies:
          - "03-03"

  # ============================================================================
  # PHASE 4: US-002 (Update)
  # ============================================================================
  # User Story: Update nWave to Latest Release (/nw:update)
  # 10 scenarios total

  - phase_id: "04"
    name: "US-002: Update"
    focus: Update nWave to Latest Release (/nw:update)
    rationale: Core update functionality with safety features
    target_scenarios: 10
    steps:
      - step_id: "04-01"
        name: "Successful update with backup creation"
        description: |
          ACTIVE SCENARIO - First implementation
          Giulia updates from v1.2.3 to v1.3.0.
          Create backup, download, validate checksum, update, verify.
        type: scenario_implementation
        acceptance_scenario: "Successful update with backup creation"
        acceptance_test_line: 112
        components:
          - name: UpdateService
            type: application_service
            location: nWave/core/versioning/application/update_service.py
          - name: DownloadAdapter
            type: driven_adapter
            location: nWave/infrastructure/versioning/download_adapter.py
          - name: ChecksumAdapter
            type: driven_adapter
            location: nWave/infrastructure/versioning/checksum_adapter.py
          - name: update_cli
            type: driving_adapter
            location: nWave/cli/update_cli.py
        dependencies:
          - "01-04"
          - "01-05"
          - "02-04"
          - "02-05"
          - "03-01"

      - step_id: "04-02"
        name: "Major version change requires confirmation"
        description: |
          Paolo on v1.3.0, v2.0.0 available.
          Show warning about major version change, wait for confirmation.
        type: scenario_implementation
        acceptance_scenario: "Major version change requires confirmation"
        acceptance_test_line: 126
        components: []
        dependencies:
          - "04-01"

      - step_id: "04-03"
        name: "Major version update proceeds with confirmation"
        description: |
          Paolo confirms major version update from v1.3.0 to v2.0.0.
          Update proceeds after "y" confirmation.
        type: scenario_implementation
        acceptance_scenario: "Major version update proceeds with confirmation"
        acceptance_test_line: 135
        components: []
        dependencies:
          - "04-02"

      - step_id: "04-04"
        name: "Major version update cancelled with denial"
        description: |
          Paolo denies major version update.
          Update cancelled, VERSION unchanged, no backup created.
        type: scenario_implementation
        acceptance_scenario: "Major version update cancelled with denial"
        acceptance_test_line: 145
        components: []
        dependencies:
          - "04-02"

      - step_id: "04-05"
        name: "Local RC version triggers customization warning"
        description: |
          Francesca has RC version v1.2.3-rc.main.20260127.1.
          Show warning about local customizations being overwritten.
        type: scenario_implementation
        acceptance_scenario: "Local RC version triggers customization warning"
        acceptance_test_line: 155
        components: []
        dependencies:
          - "04-01"

      - step_id: "04-06"
        name: "Network failure during download leaves installation unchanged"
        description: |
          Antonio's download fails mid-stream.
          Error displayed, original installation unchanged, no partial files.
        type: scenario_implementation
        acceptance_scenario: "Network failure during download leaves installation unchanged"
        acceptance_test_line: 165
        components: []
        dependencies:
          - "04-01"

      - step_id: "04-07"
        name: "Checksum validation failure aborts update"
        description: |
          Chiara's download has wrong checksum.
          Error displayed, corrupted download deleted, installation unchanged.
        type: scenario_implementation
        acceptance_scenario: "Checksum validation failure aborts update"
        acceptance_test_line: 177
        components: []
        dependencies:
          - "04-01"

      - step_id: "04-08"
        name: "Backup rotation maintains exactly 3 copies"
        description: |
          Roberto has 3 existing backups, performs update.
          New backup created, oldest deleted, exactly 3 remain.
        type: scenario_implementation
        acceptance_scenario: "Backup rotation maintains exactly 3 copies"
        acceptance_test_line: 188
        components: []
        dependencies:
          - "04-01"

      - step_id: "04-09"
        name: "Non-nWave user content is preserved during update"
        description: |
          Maria has custom agents and commands.
          Update replaces only nw-prefixed content, user content untouched.
        type: scenario_implementation
        acceptance_scenario: "Non-nWave user content is preserved during update"
        acceptance_test_line: 202
        components: []
        dependencies:
          - "04-01"

      - step_id: "04-10"
        name: "Already up-to-date shows message without update"
        description: |
          Sofia already has v1.3.0, latest is v1.3.0.
          Display message, no backup, no download.
        type: scenario_implementation
        acceptance_scenario: "Already up-to-date shows message without update"
        acceptance_test_line: 217
        components: []
        dependencies:
          - "04-01"

  # ============================================================================
  # PHASE 5: US-003 (Forge)
  # ============================================================================
  # User Story: Build Custom Local Distribution (/nw:forge)
  # 7 scenarios total

  - phase_id: "05"
    name: "US-003: Forge"
    focus: Build Custom Local Distribution (/nw:forge)
    rationale: Power user capability for custom distributions
    target_scenarios: 7
    steps:
      - step_id: "05-01"
        name: "Successful build with install prompt on main branch"
        description: |
          ACTIVE SCENARIO - First implementation
          Alessandro builds on main branch, tests pass.
          Clean dist/, run tests, build, create RC version, prompt for install.
        type: scenario_implementation
        acceptance_scenario: "Successful build with install prompt on main branch"
        acceptance_test_line: 242
        components:
          - name: BuildService
            type: application_service
            location: nWave/core/versioning/application/build_service.py
          - name: GitAdapter
            type: driven_adapter
            location: nWave/infrastructure/versioning/git_adapter.py
          - name: forge_cli
            type: driving_adapter
            location: nWave/cli/forge_cli.py
        dependencies:
          - "01-02"
          - "02-03"

      - step_id: "05-02"
        name: "Build fails when tests fail"
        description: |
          Benedetta's tests fail.
          Build aborts, error with failure count, dist/ unchanged.
        type: scenario_implementation
        acceptance_scenario: "Build fails when tests fail"
        acceptance_test_line: 256
        components: []
        dependencies:
          - "05-01"

      - step_id: "05-03"
        name: "RC counter increments on same day builds"
        description: |
          Carlo builds twice on same day.
          Second build increments counter: 20260127.1 -> 20260127.2.
        type: scenario_implementation
        acceptance_scenario: "RC counter increments on same day builds"
        acceptance_test_line: 268
        components: []
        dependencies:
          - "05-01"

      - step_id: "05-04"
        name: "RC counter resets on new day"
        description: |
          Carlo builds day after previous build.
          Counter resets: 20260127.3 -> 20260128.1.
        type: scenario_implementation
        acceptance_scenario: "RC counter resets on new day"
        acceptance_test_line: 280
        components: []
        dependencies:
          - "05-03"

      - step_id: "05-05"
        name: "Feature branch name included in RC version"
        description: |
          Daniela builds on feature/new-agent branch.
          Version becomes 1.2.3-rc.feature-new-agent.20260127.1.
        type: scenario_implementation
        acceptance_scenario: "Feature branch name included in RC version"
        acceptance_test_line: 291
        components: []
        dependencies:
          - "05-01"

      - step_id: "05-06"
        name: "User declines install after successful build"
        description: |
          Alessandro responds "n" to install prompt.
          dist/ contains build, no installation to ~/.claude/.
        type: scenario_implementation
        acceptance_scenario: "User declines install after successful build"
        acceptance_test_line: 302
        components: []
        dependencies:
          - "05-01"

      - step_id: "05-07"
        name: "User accepts install after successful build"
        description: |
          Alessandro responds "Y" to install prompt.
          /nw:forge:install is invoked, distribution installed.
        type: scenario_implementation
        acceptance_scenario: "User accepts install after successful build"
        acceptance_test_line: 312
        components: []
        dependencies:
          - "05-06"
          - "06-01"

  # ============================================================================
  # PHASE 6: US-004 (Forge Install)
  # ============================================================================
  # User Story: Install Built Distribution (/nw:forge:install)
  # 5 scenarios total

  - phase_id: "06"
    name: "US-004: Forge Install"
    focus: Install Built Distribution (/nw:forge:install)
    rationale: Completes the local build workflow
    target_scenarios: 5
    steps:
      - step_id: "06-01"
        name: "Successful installation with smoke test"
        description: |
          ACTIVE SCENARIO - First implementation
          Elena installs valid dist/ to ~/.claude/.
          Copy files, replace nw-prefixed content, run smoke test, success message.
        type: scenario_implementation
        acceptance_scenario: "Successful installation with smoke test"
        acceptance_test_line: 339
        components:
          - name: forge_install_cli
            type: driving_adapter
            location: nWave/cli/forge_install_cli.py
        dependencies:
          - "01-05"
          - "03-01"

      - step_id: "06-02"
        name: "Installation preserves non-nWave user content"
        description: |
          Elena has custom agents and commands.
          Installation preserves user content, replaces only nw-prefixed.
        type: scenario_implementation
        acceptance_scenario: "Installation preserves non-nWave user content"
        acceptance_test_line: 351
        components: []
        dependencies:
          - "06-01"

      - step_id: "06-03"
        name: "Installation fails when dist/ directory does not exist"
        description: |
          Fabio has no dist/ directory.
          Error displayed, ~/.claude/ unchanged, non-zero exit.
        type: scenario_implementation
        acceptance_scenario: "Installation fails when dist/ directory does not exist"
        acceptance_test_line: 360
        components: []
        dependencies:
          - "06-01"

      - step_id: "06-04"
        name: "Installation fails when dist/ is missing required files"
        description: |
          Greta has empty dist/ directory.
          Error about missing files, ~/.claude/ unchanged, non-zero exit.
        type: scenario_implementation
        acceptance_scenario: "Installation fails when dist/ is missing required files"
        acceptance_test_line: 368
        components: []
        dependencies:
          - "06-01"

      - step_id: "06-05"
        name: "Smoke test failure reports error"
        description: |
          Elena's dist/ has corrupted files.
          Installation proceeds, smoke test fails, warning displayed.
        type: scenario_implementation
        acceptance_scenario: "Smoke test failure reports error"
        acceptance_test_line: 377
        components: []
        dependencies:
          - "06-01"

  # ============================================================================
  # PHASE 7: US-005 (Forge Release)
  # ============================================================================
  # User Story: Create Official Release (/nw:forge:release)
  # 6 scenarios total

  - phase_id: "07"
    name: "US-005: Forge Release"
    focus: Create Official Release (/nw:forge:release)
    rationale: Admin workflow for official releases via CI/CD
    target_scenarios: 6
    steps:
      - step_id: "07-01"
        name: "Successful release PR creation from development branch"
        description: |
          ACTIVE SCENARIO - First implementation
          Matteo creates release PR from development branch.
          PR created via gh CLI, output shows PR number and URL.
        type: scenario_implementation
        acceptance_scenario: "Successful release PR creation from development branch"
        acceptance_test_line: 402
        components:
          - name: ReleaseService
            type: application_service
            location: nWave/core/versioning/application/release_service.py
          - name: GitHubCLIAdapter
            type: driven_adapter
            location: nWave/infrastructure/versioning/github_cli_adapter.py
          - name: forge_release_cli
            type: driving_adapter
            location: nWave/cli/forge_release_cli.py
        dependencies:
          - "02-03"
          - "05-01"

      - step_id: "07-02"
        name: "Release command fails on main branch"
        description: |
          Paola is on main branch.
          Error displayed, no PR created, non-zero exit.
        type: scenario_implementation
        acceptance_scenario: "Release command fails on main branch"
        acceptance_test_line: 412
        components: []
        dependencies:
          - "07-01"

      - step_id: "07-03"
        name: "Release command fails on feature branch"
        description: |
          Paola is on feature/test branch.
          Error displayed, no PR created, non-zero exit.
        type: scenario_implementation
        acceptance_scenario: "Release command fails on feature branch"
        acceptance_test_line: 420
        components: []
        dependencies:
          - "07-02"

      - step_id: "07-04"
        name: "Permission denied for non-admin user"
        description: |
          Oscar lacks repository write access.
          Permission denied error, no PR created, non-zero exit.
        type: scenario_implementation
        acceptance_scenario: "Permission denied for non-admin user"
        acceptance_test_line: 428
        components: []
        dependencies:
          - "07-01"

      - step_id: "07-05"
        name: "Release fails with uncommitted changes"
        description: |
          Matteo has uncommitted changes.
          Error displayed, no PR created, non-zero exit.
        type: scenario_implementation
        acceptance_scenario: "Release fails with uncommitted changes"
        acceptance_test_line: 437
        components: []
        dependencies:
          - "07-01"

      - step_id: "07-06"
        name: "Release shows pipeline status after PR creation"
        description: |
          Matteo creates PR with CI/CD configured.
          PR created, output shows PR number and pipeline monitoring URL.
        type: scenario_implementation
        acceptance_scenario: "Release shows pipeline status after PR creation"
        acceptance_test_line: 448
        components: []
        dependencies:
          - "07-01"

# ============================================================================
# SUMMARY
# ============================================================================

summary:
  total_phases: 7
  total_steps: 45
  breakdown:
    domain_model_steps: 5
    port_interface_steps: 5
    scenario_implementation_steps: 35
  scenarios_by_user_story:
    us-001_version_check: 7
    us-002_update: 10
    us-003_forge: 7
    us-004_forge_install: 5
    us-005_forge_release: 6
  active_scenarios: 5
  skipped_scenarios: 30
  components_to_implement: 20

# ============================================================================
# VALIDATION
# ============================================================================
# Reviewer: software-crafter-reviewer (Crafty)
# Review Date: 2026-01-28

validation:
  status: APPROVED
  reviewer: software-crafter-reviewer
  review_date: "2026-01-28T00:00:00Z"
  revision: 2

  scenario_coverage_validation:
    status: PASSED
    total_scenarios: 35
    mapped_scenarios: 35
    findings:
      - "US-001: 7 scenarios mapped to steps 03-01 through 03-07 - ALL LINE NUMBERS VERIFIED"
      - "US-002: 10 scenarios mapped to steps 04-01 through 04-10 - ALL LINE NUMBERS VERIFIED"
      - "US-003: 7 scenarios mapped to steps 05-01 through 05-07 - ALL LINE NUMBERS VERIFIED"
      - "US-004: 5 scenarios mapped to steps 06-01 through 06-05 - ALL LINE NUMBERS VERIFIED"
      - "US-005: 6 scenarios mapped to steps 07-01 through 07-06 - ALL LINE NUMBERS VERIFIED"
    evidence:
      - "Cross-referenced all 35 scenario names and line numbers against acceptance-tests.feature"
      - "1:1 step-to-scenario mapping confirmed for phases 3-7"

  dependency_validation:
    status: PASSED
    circular_dependencies: false
    findings:
      - "Phase 1 dependencies: Correctly ordered (Version -> RCVersion, Watermark)"
      - "Phase 2 dependencies: Correctly reference Phase 1 domain models"
      - "Cross-phase dependencies: 05-07 correctly depends on 06-01 (forge->install flow)"
      - "No circular dependency chains detected"
    dependency_chain_verified:
      - "01-01 Version (no deps) -> 01-02 RCVersion, 01-03 Watermark"
      - "02-01 GitHubAPIPort -> 01-01 Version (return type)"
      - "02-02 FileSystemPort -> 01-03 Watermark, 01-04 BackupPolicy"
      - "03-01 VersionService -> 01-01, 01-03, 02-01, 02-02"
      - "04-01 UpdateService -> 01-04, 01-05, 02-04, 02-05, 03-01"
      - "05-07 (forge accept) -> 06-01 (forge:install) - VALID cross-story dependency"

  phase_sequencing_validation:
    status: PASSED
    hexagonal_compliance: true
    findings:
      - "Phase 1 (Domain Model): Pure domain logic first - CORRECT per hexagonal architecture"
      - "Phase 2 (Port Interfaces): Contracts defined before adapters - CORRECT"
      - "Phases 3-7 (User Stories): Application services + adapters built on domain foundation - CORRECT"
    sequence_verified: "Domain Core -> Ports -> Application + Adapters"

  active_scenarios_validation:
    status: PASSED
    active_count: 5
    findings:
      - "03-01: Display version with update available (line 32) - MATCHES baseline"
      - "04-01: Successful update with backup creation (line 112) - MATCHES baseline"
      - "05-01: Successful build with install prompt (line 242) - MATCHES baseline"
      - "06-01: Successful installation with smoke test (line 339) - MATCHES baseline"
      - "07-01: Successful release PR creation (line 402) - MATCHES baseline"

  step_count_validation:
    status: PASSED
    verification_attempt: 2
    details:
      total_steps: 45
      breakdown:
        domain_model_steps: 5
        port_interface_steps: 5
        scenario_implementation_steps: 35
      calculation: "5 + 5 + (7 + 10 + 7 + 5 + 6) = 5 + 5 + 35 = 45"
    previous_issue_resolved: "Summary counts corrected from 37/27 to 45/35"

  overall_assessment:
    quality_score: 0.98
    strengths:
      - "Complete 1:1 scenario-to-step mapping with verified line numbers"
      - "Sound hexagonal architecture phase ordering"
      - "No circular dependencies"
      - "Cross-story dependencies correctly modeled (forge->install flow)"
      - "Active scenarios correctly identified per one-E2E-at-a-time strategy"
      - "Clear acceptance criteria per step"
      - "Summary counts now accurate (45 total, 35 scenario steps)"
    issues_found: []
    approval_status: APPROVED
    approval_note: |
      Roadmap APPROVED for DEVELOP wave execution.

      Verification complete:
      - Total steps: 45 (5 domain + 5 ports + 35 scenarios) - CORRECT
      - All 35 scenarios mapped with accurate acceptance-tests.feature line numbers
      - Hexagonal architecture compliance verified (Domain -> Ports -> Application)
      - Dependency chains valid with no circular references
      - 5 active scenarios aligned with one-E2E-at-a-time strategy

      Ready for handoff to software-crafter for DEVELOP wave implementation.
