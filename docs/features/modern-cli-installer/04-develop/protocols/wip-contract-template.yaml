# ═══════════════════════════════════════════════════════════════════════════════
# WIP.yaml - Work In Progress Contract Template
# Schema Version: 0.1 (Experimental)
# ═══════════════════════════════════════════════════════════════════════════════
#
# USAGE: Orchestrator copies this template, fills in step-specific values,
#        writes to docs/{feature}/04-develop/WIP.yaml
#
# ═══════════════════════════════════════════════════════════════════════════════

meta:
  generated_at: "{{ISO_TIMESTAMP}}"
  generated_by: "{{ORCHESTRATOR_NAME}}"
  project: "{{PROJECT_ID}}"
  phase: "{{PHASE_ID}}"
  phase_name: "{{PHASE_NAME}}"
  schema_version: "0.1"

# ─────────────────────────────────────────────────────────────────────────────
# STEP CONTRACT
# ─────────────────────────────────────────────────────────────────────────────
step:
  id: "{{STEP_ID}}"
  name: "{{STEP_NAME}}"
  agent: "{{AGENT_TYPE}}"  # software-crafter | devop | researcher
  estimated_hours: "{{HOURS}}"
  dependencies_satisfied: true  # Orchestrator verified before generating

# ─────────────────────────────────────────────────────────────────────────────
# INPUT: What the agent receives (READ-ONLY context)
# ─────────────────────────────────────────────────────────────────────────────
input:
  # File paths - choose appropriate format
  source_file: "{{SOURCE_PATH}}"
  # OR for multiple files:
  # source_files:
  #   - "{{SOURCE_PATH_1}}"
  #   - "{{SOURCE_PATH_2}}"

  test_file: "{{TEST_PATH}}"

  # Reference to existing code (optional)
  existing_code:
    reference: "{{REFERENCE_FILE_PATH}}"
    imports: |
      {{IMPORT_STATEMENTS}}

  # Requirements extracted from roadmap
  requirements:
    "{{COMPONENT_NAME}}":
      - "{{REQUIREMENT_1}}"
      - "{{REQUIREMENT_2}}"

  # Test requirements
  test_requirements:
    - "{{TEST_CASE_1}}"
    - "{{TEST_CASE_2}}"

  # Architecture notes
  architecture_notes:
    - "{{ARCHITECTURE_NOTE_1}}"
    - "{{ARCHITECTURE_NOTE_2}}"

# ─────────────────────────────────────────────────────────────────────────────
# CONSTRAINTS: Rules the agent MUST follow
# ─────────────────────────────────────────────────────────────────────────────
constraints:
  max_tool_calls: "{{MAX_CALLS}}"  # Typical: 8-15 depending on complexity
  must_run_tests: true
  fail_fast: true

  allowed_actions:
    - "Read existing files for reference patterns"
    - "Create source file(s) at input paths"
    - "Create test file at input.test_file"
    - "Create __init__.py files for new packages"
    - "Run pytest on test file"
    - "Commit changes with conventional commit format"

  forbidden_actions:
    - "DO NOT read roadmap.yaml"
    - "DO NOT read execution-log.yaml"
    - "DO NOT modify WIP.yaml (orchestrator does this)"
    - "DO NOT implement other steps"
    - "DO NOT add external dependencies"
    - "DO NOT create files outside allowed paths"

# ─────────────────────────────────────────────────────────────────────────────
# OUTPUT: What the agent must deliver (AGENT FILLS THIS SECTION)
# ─────────────────────────────────────────────────────────────────────────────
output:
  status: null          # success | failed | blocked
  artifacts_created: [] # list of file paths created/modified
  test_command: null    # exact pytest command used
  test_result: null     # PASS: X tests | FAIL: reason
  commit_hash: null     # git commit hash
  commit_message: null  # conventional commit message used
  notes: null           # any issues, observations, or blockers
