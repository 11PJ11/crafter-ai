meta:
  generated_at: "2026-02-05T16:15:00Z"
  generated_by: "vera-orchestrator"
  project: "modern-cli-installer"
  phase: "10"
  phase_name: "Full Installation Journey (Walking Skeleton Integration)"
  schema_version: "0.2"

step:
  id: "10-04"
  name: "Add deployment validation section to forge_install.py"
  agent: "software-crafter"
  estimated_hours: 2
  dependencies_satisfied: true  # 10-03 completed

input:
  source_file: "src/crafter_ai/installer/cli/forge_install.py"
  test_file: "tests/acceptance/forge_tui/test_walking_skeleton.py::TestWalkingSkeletonBuildToInstall::test_deployment_validation_output"

  requirements:
    create_install_service_factory:
      - "In create_install_service() function (around line 248)"
      - "Import DeploymentValidationService from installer.services.deployment_validation_service"
      - "Create deployment_validation_service = DeploymentValidationService(filesystem=filesystem)"
      - "Add deployment_validation_service parameter to InstallService constructor"
      - "Follow optional injection pattern (deployment_validation_service=deployment_validation_service)"

    install_command_display:
      - "In install() function after asset deployment (after line ~430)"
      - "Add blank line: console.print()"
      - "Add section header: console.print('  üîç Validating deployment')"
      - "Show 6 check lines with ‚úÖ emoji:"
      - "  console.print(f'  ‚úÖ Agents verified ({agent_count})')"
      - "  console.print(f'  ‚úÖ Commands verified ({command_count})')"
      - "  console.print(f'  ‚úÖ Templates verified ({template_count})')"
      - "  console.print(f'  ‚úÖ Scripts verified ({script_count})')"
      - "  console.print('  ‚úÖ Manifest created')"
      - "  console.print(f'  ‚úÖ Schema validated (v3.0, {phase_count} phases)')"
      - "Add summary line: console.print('  ‚úÖ Deployment validated')"
      - "Extract data from install_result.deployment_validation_result"
      - "Only show if install_result.deployment_validation_result is not None"

  test_requirements:
    - "Walking skeleton test test_deployment_validation_output must pass"
    - "Test expects: 'Validating deployment' in output"
    - "Test expects: 'Deployment validated' in output"
    - "Test location: tests/acceptance/forge_tui/test_walking_skeleton.py line 694"

  architecture_notes:
    - "DeploymentValidationService was implemented in Phase 09-06"
    - "InstallService needs optional deployment_validation_service parameter (ADR-001 pattern)"
    - "InstallResult.deployment_validation_result was added in Phase 09-08"
    - "No spinner needed - validation checks are fast (~100ms total)"
    - "Format matches pre-flight checks pattern: emoji stream with check marks"

  luna_design_reference:
    - "docs/ux/modern-cli-installer/journey-forge-tui-visual.md lines 141-148"
    - "Validation section shows 6 checks as streaming list"
    - "Summary line confirms all validations passed"
    - "Schema validation shows version and phase count"

constraints:
  max_tool_calls: 20
  must_run_tests: true
  fail_fast: true
  forbidden_actions:
    - "DO NOT skip running E2E test first"
    - "DO NOT modify scripts/testpypi_validation.py"
    - "DO NOT read roadmap.yaml or execution-log.yaml"

output:
  status: null
  artifacts_created: []
  test_command: null
  test_result: null
  commit_hash: null
  commit_message: null
  notes: null
