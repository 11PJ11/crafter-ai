meta:
  generated_at: "2026-02-05T17:00:00Z"
  generated_by: "vera-orchestrator"
  project: "modern-cli-installer"
  phase: "10"
  phase_name: "Full Installation Journey (Walking Skeleton Integration)"
  schema_version: "0.2"

step:
  id: "10-05"
  name: "Add SBOM dual-group format section to forge_install.py"
  agent: "software-crafter"
  estimated_hours: 2
  dependencies_satisfied: true  # 10-04 completed

input:
  source_file: "src/crafter_ai/installer/cli/forge_install.py"
  test_file: "tests/acceptance/forge_tui/test_walking_skeleton.py::TestWalkingSkeletonBuildToInstall::test_sbom_dual_group_format"

  requirements:
    sbom_section_location:
      - "In install() function after deployment validation (after line ~491)"
      - "Add blank line before SBOM section"
      - "Add section header: console.print('  ðŸ“‹ What was installed')"

    cli_package_group:
      - "Show package name and version: console.print(f'[dim]    crafter-ai {install_result.version}[/dim]')"
      - "Show CLI entry points: console.print('[dim]    CLI: crafter-ai, nw[/dim]')"
      - "Show install path: console.print('[dim]    â†’ ~/.local/pipx/venvs/crafter-ai[/dim]')"
      - "Add blank line to separate CLI from IDE assets"

    ide_assets_group:
      - "Show agent count: console.print(f'[dim]    {deployment.agents_deployed} agents â†’ ~/.claude/agents/nw/[/dim]')"
      - "Show command count: console.print(f'[dim]    {deployment.commands_deployed} commands â†’ ~/.claude/commands/nw/[/dim]')"
      - "Show template count: console.print(f'[dim]    {deployment.templates_deployed} templates â†’ ~/.claude/templates/[/dim]')"
      - "Show script count: console.print(f'[dim]    {deployment.scripts_deployed} scripts â†’ ~/.claude/scripts/[/dim]')"
      - "Show config: console.print('[dim]    1 config â†’ ~/.claude/agents/nw/config.json[/dim]')"
      - "Show manifest: console.print('[dim]    1 manifest â†’ ~/.claude/nwave-manifest.txt[/dim]')"
      - "Extract counts from install_result.asset_deployment_result"

  test_requirements:
    - "Walking skeleton test test_sbom_dual_group_format must pass"
    - "Test expects: 'What was installed' in output"
    - "Test expects: 'crafter-ai' or 'crafter_ai' with version in output"
    - "Test expects: '~/.claude/' in output (IDE assets marker)"
    - "Test location: tests/acceptance/forge_tui/test_walking_skeleton.py line 778"

  architecture_notes:
    - "SBOM section goes AFTER deployment validation and BEFORE health check"
    - "Two groups: CLI package (what pipx installed) + IDE assets (what went to ~/.claude/)"
    - "Blank line separates the two groups"
    - "All lines use [dim] style for visual hierarchy"
    - "â†’ notation shows destination paths"
    - "Counts come from install_result.asset_deployment_result"

  luna_design_reference:
    - "docs/ux/modern-cli-installer/journey-forge-tui-visual.md lines 149-168"
    - "SBOM format: header, CLI group (3 lines), blank line, IDE assets (6 lines)"
    - "Config and manifest are hardcoded as '1' (always present)"

constraints:
  max_tool_calls: 20
  must_run_tests: true
  fail_fast: true
  forbidden_actions:
    - "DO NOT skip running E2E test first"
    - "DO NOT modify scripts/testpypi_validation.py"
    - "DO NOT read roadmap.yaml or execution-log.yaml"

output:
  status: "BLOCKED"
  artifacts_created:
    - "src/crafter_ai/installer/cli/forge_install.py (lines 491-511 added SBOM section)"
    - "tests/acceptance/forge_tui/test_walking_skeleton.py (removed obsolete ReleaseReportService mock)"
  test_command: "pytest tests/acceptance/forge_tui/test_walking_skeleton.py::TestWalkingSkeletonBuildToInstall::test_sbom_dual_group_format -v"
  test_result: "PASSED"
  commit_hash: "NOT_COMMITTED"
  commit_message: |
    feat(installer): add SBOM dual-group format to forge install

    - Added SBOM section after deployment validation
    - CLI package group: crafter-ai version, CLI entry points, install path
    - IDE assets group: agents, commands, templates, scripts, config, manifest
    - Removed obsolete ReleaseReportService mock from walking skeleton test
    - Test test_sbom_dual_group_format now passes

    Step 10-05: SBOM section displays what was installed (CLI + IDE assets)

    Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
  notes: |
    BLOCKED BY PRE-COMMIT HOOK:
    - Target test (test_sbom_dual_group_format) PASSES âœ“
    - Step 10-05 implementation COMPLETE âœ“
    - BUT: Pre-commit hook blocks due to 80 failing tests in tests/installer/cli/test_forge_install.py
    - These tests fail because they try to mock 'ReleaseReportService' which doesn't exist in forge_install.py
    - ReleaseReportService appears to be from an older design that was removed/never implemented
    - According to WIP constraints: "DO NOT implement other steps (10-06 through 10-10)"
    - These ReleaseReportService tests are unrelated to step 10-05 (SBOM display)
    - Recommendation: Fix ReleaseReportService tests in separate step OR remove obsolete tests
    - Current blocker: Cannot commit without --no-verify which bypasses quality gates
