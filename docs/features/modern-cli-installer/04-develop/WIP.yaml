meta:
  generated_at: "2026-02-05T19:15:00Z"
  generated_by: "vera-orchestrator"
  project: "modern-cli-installer"
  phase: "10"
  phase_name: "Full Installation Journey (Walking Skeleton Integration)"
  schema_version: "0.2"

step:
  id: "10-01"
  name: "Add IDE bundle build section to forge_build.py"
  agent: "software-crafter"
  estimated_hours: 2
  dependencies_satisfied: true  # 09-04 completed

input:
  source_file: "src/crafter_ai/installer/cli/forge_build.py"
  test_file: "tests/acceptance/forge_tui/test_walking_skeleton.py::TestWalkingSkeletonBuildToInstall::test_ide_bundle_build_output"

  requirements:
    factory_changes:
      - "In create_build_service() factory (line 35):"
      - "Import IdeBundleBuildService from crafter_ai.installer.services.ide_bundle_build_service"
      - "Import FileSystemAdapter from crafter_ai.installer.adapters.filesystem_adapter"
      - "Import DEFAULT_SOURCE_DIR, DEFAULT_OUTPUT_DIR from crafter_ai.installer.domain.ide_bundle_constants"
      - "Instantiate: filesystem = FileSystemAdapter()"
      - "Instantiate: ide_bundle_build_service = IdeBundleBuildService(filesystem=filesystem)"
      - "Pass ide_bundle_build_service to BuildService constructor (keyword arg)"
      - "BuildService already accepts this param with None default (Phase 09-04)"

    display_function_changes:
      - "Create new function: display_ide_bundle_build(result: IdeBundleBuildResult, duration: str) -> None"
      - "Section header: console.print('  ⚙️ Building IDE bundle')"
      - "Detail lines (dim style):"
      - "  - console.print(f'  {result.agent_count} agents', style='dim')"
      - "  - console.print(f'  {result.command_count} commands', style='dim')"
      - "  - console.print(f'  {result.team_count} teams', style='dim')"
      - "If result.embed_injection_count > 0: console.print(f'  {result.embed_injection_count} embeds injected', style='dim')"
      - "If result.yaml_warnings: for warning in result.yaml_warnings: console.print(f'  ⚠️ {warning}', style='yellow')"
      - "Completion line: console.print(f'  ✅ IDE bundle built ({duration})')"
      - "Blank line: console.print()"

    build_command_integration:
      - "In build_command() function, after display_wheel_validation() call (around line 130-140):"
      - "If result.ide_bundle_result is not None:"
      - "  Call display_ide_bundle_build(result.ide_bundle_result, duration='0.3s')"
      - "Note: Duration is placeholder for now (actual timing from BuildResult not yet available)"

  test_requirements:
    - "Walking skeleton test test_ide_bundle_build_output must pass"
    - "Test expects: 'Building IDE bundle' in output"
    - "Test expects: 'IDE bundle built' in output"
    - "Test location: tests/acceptance/forge_tui/test_walking_skeleton.py line 477"

  architecture_notes:
    - "BuildService already has ide_bundle_build_service optional param (Phase 09-04)"
    - "BuildResult already has ide_bundle_result field (Phase 09-04)"
    - "IdeBundleBuildResult is in crafter_ai.installer.domain.ide_bundle_build_result"
    - "DEFAULT_SOURCE_DIR = Path('src/crafter_ai/installer/embedded')"
    - "DEFAULT_OUTPUT_DIR = Path('dist/ide')"
    - "This is the first visible connection between Phase 09 backend and CLI layer"
    - "Spinner animation not yet implemented (Phase 10 focuses on content, spinners later)"

  luna_design_reference:
    - "docs/ux/modern-cli-installer/journey-forge-tui-visual.md lines 97-107"
    - "Section shows: header, spinner placeholder, detail counts, completion"
    - "Emoji: ⚙️ for section header, ✅ for completion"

constraints:
  max_tool_calls: 20
  must_run_tests: true
  fail_fast: true
  forbidden_actions:
    - "DO NOT skip running E2E test first"
    - "DO NOT modify scripts/testpypi_validation.py"
    - "DO NOT read roadmap.yaml or execution-log.yaml"

output:
  status: null
  artifacts_created: []
  test_command: null
  test_result: null
  commit_hash: null
  commit_message: null
  notes: null
