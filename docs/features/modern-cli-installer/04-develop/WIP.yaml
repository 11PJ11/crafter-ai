# ═══════════════════════════════════════════════════════════════════════════════
# WIP.yaml - Work In Progress Contract
# Generated by: Vera (Orchestrator)
# Protocol Version: 0.1
# ═══════════════════════════════════════════════════════════════════════════════

meta:
  generated_at: "2026-02-02T22:50:00Z"
  project: "modern-cli-installer"
  phase: "03"
  phase_name: "Journey 2 - Install Local Candidate"

# ─────────────────────────────────────────────────────────────────────────────
# STEP CONTRACT
# ─────────────────────────────────────────────────────────────────────────────
step:
  id: "03-09"
  name: "Create multiple wheel selection prompt"
  agent: "software-crafter"
  estimated_hours: 2
  dependencies_satisfied: true
  user_stories: ["US-029"]
  scenario: "journey_2_install.feature::User can select from multiple wheels in dist/"

# ─────────────────────────────────────────────────────────────────────────────
# INPUT: What the agent receives (READ-ONLY context)
# ─────────────────────────────────────────────────────────────────────────────
input:
  source_file: "src/crafter_ai/installer/cli/forge_install.py"
  test_file: "tests/installer/cli/test_forge_install.py"

  existing_code:
    forge_install: "src/crafter_ai/installer/cli/forge_install.py"

  requirements:
    wheel_selection:
      - "When multiple wheels exist in dist/ and no --wheel specified"
      - "Display numbered list of available wheels with version and date"
      - "Prompt: 'Multiple wheels found. Select one [1-N]'"
      - "User enters number to select wheel"
      - "In CI mode: auto-select newest wheel (by modification time)"

    display_format:
      - "1. crafter_ai-0.1.0-py3-none-any.whl (2026-02-02 10:30)"
      - "2. crafter_ai-0.0.9-py3-none-any.whl (2026-02-01 14:20)"
      - "Most recent wheel listed first"
      - "Show file size in human-readable format"

    edge_cases:
      - "Single wheel: use it directly (no prompt)"
      - "No wheels: trigger auto-chain build (existing behavior)"
      - "Invalid selection: re-prompt or show error"
      - "CI mode: auto-select newest, log which was selected"

  test_requirements:
    - "Test single wheel skips selection prompt"
    - "Test multiple wheels displays numbered list"
    - "Test user selection returns correct wheel"
    - "Test invalid selection shows error"
    - "Test CI mode auto-selects newest"
    - "Test --no-prompt auto-selects newest"
    - "Test list sorted by modification time (newest first)"
    - "Mock filesystem for wheel listing"

  architecture_notes:
    - "Extends existing forge_install.py"
    - "Modifies wheel resolution logic"
    - "Uses Rich for formatted display"
    - "Minimal changes to existing flow"

# ─────────────────────────────────────────────────────────────────────────────
# CONSTRAINTS: Rules the agent MUST follow
# ─────────────────────────────────────────────────────────────────────────────
constraints:
  max_tool_calls: 20
  must_run_tests: true
  fail_fast: true

  allowed_actions:
    - "Read existing forge_install.py"
    - "Modify source file at input.source_file"
    - "Add tests to input.test_file"
    - "Run pytest on test file"
    - "Commit changes"

  forbidden_actions:
    - "DO NOT read roadmap.yaml"
    - "DO NOT read execution-status.yaml"
    - "DO NOT modify WIP.yaml (orchestrator does this)"
    - "DO NOT implement other steps"
    - "DO NOT break existing tests"

# ─────────────────────────────────────────────────────────────────────────────
# OUTPUT: What the agent must deliver (AGENT FILLS THIS SECTION)
# ─────────────────────────────────────────────────────────────────────────────
output:
  status: pending
  artifacts_created: []
  test_command: ""
  test_result: ""
  commit_hash: ""
  commit_message: ""
  notes: ""
