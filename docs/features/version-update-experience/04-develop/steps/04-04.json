{
  "task_specification": {
    "task_id": "04-04",
    "name": "Update fails - automatic rollback",
    "description": "Implement automatic rollback mechanism to restore previous version on update failure.",
    "acceptance_test_scenario": "tests/acceptance/features/version-update-experience/us-002-update-safely.feature::update_fails_mid_process_automatic_rollback",
    "requires": [
      "04-01"
    ],
    "estimated_hours": 3,
    "agent": "software-crafter"
  },
  "acceptance_criteria": [
    "Automatic rollback on failure",
    "Previous version restored"
  ],
  "tdd_cycle": {
    "tdd_phase_tracking": {
      "phase_execution_log": [
        {
          "phase_name": "PREPARE",
          "timestamp": "2026-01-26T08:33:59.896593",
          "duration_minutes": 1,
          "outcome": "PASS",
          "notes": "Removed @skip tag from scenario: update_fails_mid_process_automatic_rollback",
          "artifacts": [
            "tests/acceptance/features/version-update-experience/us-002-update-safely.feature"
          ],
          "validation_result": "One scenario enabled for TDD cycle"
        },
        {
          "phase_name": "RED_ACCEPTANCE",
          "timestamp": "2026-01-26T08:34:53.802610",
          "duration_minutes": 2,
          "outcome": "PASS",
          "notes": "Test fails with StepDefinitionNotFoundError - missing step definitions for backup and rollback flow",
          "artifacts": [
            "test_update_steps.py::test_update_fails_midprocess__automatic_rollback"
          ],
          "validation_result": "Test fails for correct reason (missing implementation)"
        },
        {
          "phase_name": "RED_UNIT",
          "timestamp": "2026-01-26T09:15:00.000000",
          "duration_minutes": 8,
          "outcome": "PASS",
          "notes": "Created 4 unit tests for BackupManager.restore_from_backup(): test_restore_from_backup_copies_files_back, test_restore_overwrites_corrupted_installation, test_restore_raises_error_if_backup_not_found, test_restore_preserves_file_permissions. All tests fail as expected (BackupManager not implemented).",
          "artifacts": [
            "tests/unit/update/test_backup_manager.py"
          ],
          "validation_result": "Unit tests fail for correct reason (missing BackupManager implementation)"
        },
        {
          "phase_name": "GREEN_UNIT",
          "timestamp": "2026-01-26T09:30:00.000000",
          "duration_minutes": 12,
          "outcome": "PASS",
          "notes": "Implemented BackupManager class with restore_from_backup() method using shutil.copy2 for metadata preservation and shutil.copytree for recursive directory copying. Raises FileNotFoundError if backup_path does not exist. All 4 unit tests passing.",
          "artifacts": [
            "src/nwave/update/backup_manager.py"
          ],
          "validation_result": "All unit tests pass"
        },
        {
          "phase_name": "CHECK_ACCEPTANCE",
          "timestamp": "2026-01-26T09:50:00.000000",
          "duration_minutes": 5,
          "outcome": "PASS",
          "notes": "Fixed scenario structure by adding missing CLI invocation step (line 51). Test now executes correctly but fails as expected - CLI output shows backup creation and changelog but missing 'Restored from backup' message. Fails for RIGHT reason (CLI integration not implemented), not wrong reason (empty output).",
          "artifacts": [
            "tests/acceptance/features/version-update-experience/us-002-update-safely.feature"
          ],
          "validation_result": "Test runs correctly, fails as expected - integration needed"
        }
      ],
      "phases": [
        {
          "id": 1,
          "name": "PREPARE",
          "status": "complete"
        },
        {
          "id": 2,
          "name": "RED_ACCEPTANCE",
          "status": "complete"
        },
        {
          "id": 3,
          "name": "RED_UNIT",
          "status": "pending"
        },
        {
          "id": 4,
          "name": "GREEN_UNIT",
          "status": "pending"
        },
        {
          "id": 5,
          "name": "CHECK_ACCEPTANCE",
          "status": "pending"
        },
        {
          "id": 6,
          "name": "GREEN_ACCEPTANCE",
          "status": "pending"
        },
        {
          "id": 7,
          "name": "REVIEW",
          "status": "pending"
        },
        {
          "id": 8,
          "name": "REFACTOR_L1",
          "status": "pending"
        },
        {
          "id": 9,
          "name": "REFACTOR_L2",
          "status": "pending"
        },
        {
          "id": 10,
          "name": "REFACTOR_L3",
          "status": "pending"
        },
        {
          "id": 11,
          "name": "REFACTOR_L4",
          "status": "pending"
        },
        {
          "id": 12,
          "name": "POST_REFACTOR_REVIEW",
          "status": "pending"
        },
        {
          "id": 13,
          "name": "FINAL_VALIDATE",
          "status": "pending"
        },
        {
          "id": 14,
          "name": "COMMIT",
          "status": "pending"
        }
      ]
    }
  },
  "validation": {
    "status": "approved",
    "notes": "Valid JSON structure, all 14 TDD phases defined, scenario reference valid, dependencies match roadmap (04-01), clear acceptance criteria, concise format."
  }
}
