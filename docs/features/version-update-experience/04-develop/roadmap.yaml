# Version Update Experience - Implementation Roadmap
# Created: 2026-01-25
# Project: version-update-experience
# Total Steps: 24 (mapped to 24 acceptance test scenarios)

roadmap:
  project_id: version-update-experience
  created_at: "2026-01-25T20:00:00Z"
  validation:
    status: approved
    reviewed_by: software-crafter-reviewer
    reviewed_at: "2026-01-25T20:30:00Z"
    notes: |
      APPROVED - All criteria satisfied:

      ✓ Step-to-Scenario Mapping: All 24 steps map 1:1 to acceptance test scenarios
      ✓ Dependency Order: Respects baseline order (US-005 → US-007 → US-001 → US-002)
      ✓ Atomicity: Each step is self-contained with clear acceptance criteria
      ✓ Agent Assignment: software-crafter assigned to all implementation steps (correct)
      ✓ Acceptance Criteria: Clear, testable criteria for each step
      ✓ Technical Feasibility: Implementation approach aligns with hexagonal architecture

      Dependency Validation:
      - Phase 01 (Git Workflow): Steps 01-01 through 01-08 establish foundation
      - Phase 02 (Core Domain): Steps 02-01 through 02-03 depend on Phase 01 completion
      - Phase 03 (Adapters): Steps 03-01 through 03-02 depend on Phase 02 completion
      - Phase 04 (Update Orchestration): Steps 04-01 through 04-06 depend on Phase 03 completion
      - Phase 05 (Backup Cleanup): Steps 05-01 through 05-04 depend on Phase 04 completion

      Sequential Implementation:
      - Each step enables ONE acceptance test scenario
      - No circular dependencies detected
      - Clear progression from infrastructure → domain → adapters → orchestration → cleanup

      Ready for split phase.

phases:
  # Phase 01: Git Workflow Foundation (US-005, US-006, US-007)
  - id: "01"
    name: "Git Workflow Infrastructure"
    description: "Conventional commits, pre-push validation, semantic-release configuration"

    steps:
      - id: "01-01"
        name: "Valid conventional commit accepted"
        scenario: "tests/acceptance/features/version-update-experience/us-005-commit-enforcement.feature::valid_conventional_commit_accepted"
        agent: software-crafter
        dependencies: []
        acceptance_criteria:
          - "commitlint configuration exists"
          - "commit-msg hook installed"
          - "Valid format accepted"

      - id: "01-02"
        name: "Valid scoped commit accepted"
        scenario: "tests/acceptance/features/version-update-experience/us-005-commit-enforcement.feature::valid_scoped_commit_accepted"
        agent: software-crafter
        dependencies: ["01-01"]
        acceptance_criteria:
          - "Scoped commits accepted"

      - id: "01-03"
        name: "Breaking change commit accepted"
        scenario: "tests/acceptance/features/version-update-experience/us-005-commit-enforcement.feature::breaking_change_commit_accepted"
        agent: software-crafter
        dependencies: ["01-01"]
        acceptance_criteria:
          - "Breaking change commits accepted with ! syntax"

      - id: "01-04"
        name: "Invalid commit rejected with guidance"
        scenario: "tests/acceptance/features/version-update-experience/us-005-commit-enforcement.feature::invalid_commit_rejected_with_guidance"
        agent: software-crafter
        dependencies: ["01-01"]
        acceptance_criteria:
          - "Invalid commits rejected"
          - "Clear error guidance shown"

      - id: "01-05"
        name: "Pre-push validation passes"
        scenario: "tests/acceptance/features/version-update-experience/us-006-prepush-validation.feature::push_succeeds_when_all_validations_pass"
        agent: software-crafter
        dependencies: ["01-01"]
        acceptance_criteria:
          - "Pre-push hook installed"
          - "VERSION file validated"

      - id: "01-06"
        name: "Pre-push rejects missing VERSION"
        scenario: "tests/acceptance/features/version-update-experience/us-006-prepush-validation.feature::push_rejected_when_version_file_missing"
        agent: software-crafter
        dependencies: ["01-05"]
        acceptance_criteria:
          - "Missing VERSION file detected"

      - id: "01-07"
        name: "Changelog generated on release"
        scenario: "tests/acceptance/features/version-update-experience/us-007-changelog-generation.feature::changelog_generated_on_release"
        agent: software-crafter
        dependencies: ["01-04", "01-05"]
        acceptance_criteria:
          - "semantic-release configured"
          - "GitHub Actions workflow exists"
          - "Changelog generated automatically"

      - id: "01-08"
        name: "Breaking change in changelog"
        scenario: "tests/acceptance/features/version-update-experience/us-007-changelog-generation.feature::breaking_change_highlighted_in_changelog"
        agent: software-crafter
        dependencies: ["01-07"]
        acceptance_criteria:
          - "BREAKING CHANGES section in changelog"
          - "Major version bump triggered"

  # Phase 02: Core Domain Layer (US-001)
  - id: "02"
    name: "Version Management Core"
    description: "VersionManager, ChangelogProcessor (domain logic)"

    steps:
      - id: "02-01"
        name: "Display version when up to date"
        scenario: "tests/acceptance/features/version-update-experience/us-001-check-version.feature::display_installed_version_when_up_to_date"
        agent: software-crafter
        dependencies: ["01-08"]
        acceptance_criteria:
          - "VersionManager.check_for_updates() implemented"
          - "Local version read from VERSION file"

      - id: "02-02"
        name: "Display update banner with highlights"
        scenario: "tests/acceptance/features/version-update-experience/us-001-check-version.feature::display_installed_version_with_update_available"
        agent: software-crafter
        dependencies: ["02-01"]
        acceptance_criteria:
          - "GitHub API integration works"
          - "Changelog highlights extracted (2-3)"
          - "Update banner displayed"

      - id: "02-03"
        name: "Network failure graceful degradation"
        scenario: "tests/acceptance/features/version-update-experience/us-001-check-version.feature::network_failure_during_version_check"
        agent: software-crafter
        dependencies: ["02-01"]
        acceptance_criteria:
          - "Timeout handled gracefully"
          - "Local version shown with fallback message"

  # Phase 03: Adapters Layer (US-003)
  - id: "03"
    name: "Adapters and Breaking Change Detection"
    description: "GitHubAdapter, ConsoleUIAdapter, GitConfigAdapter"

    steps:
      - id: "03-01"
        name: "Major version update warning"
        scenario: "tests/acceptance/features/version-update-experience/us-003-breaking-changes.feature::major_version_update_warning"
        agent: software-crafter
        dependencies: ["02-02"]
        acceptance_criteria:
          - "Major version bump detected"
          - "Breaking change warning displayed prominently"

      - id: "03-02"
        name: "Minor version update (no warning)"
        scenario: "tests/acceptance/features/version-update-experience/us-003-breaking-changes.feature::minor_version_update_no_warning"
        agent: software-crafter
        dependencies: ["03-01"]
        acceptance_criteria:
          - "Minor updates show no breaking change warning"

  # Phase 04: Update Orchestration (US-002)
  - id: "04"
    name: "Update Orchestration"
    description: "UpdateOrchestrator, BackupManager, FileSystemAdapter"

    steps:
      - id: "04-01"
        name: "Successful update with backup"
        scenario: "tests/acceptance/features/version-update-experience/us-002-update-safely.feature::successful_update_with_backup"
        agent: software-crafter
        dependencies: ["03-02"]
        acceptance_criteria:
          - "Backup created before update"
          - "Update orchestration complete"
          - "Version file updated"

      - id: "04-02"
        name: "Update cancelled by user"
        scenario: "tests/acceptance/features/version-update-experience/us-002-update-safely.feature::update_cancelled_by_user"
        agent: software-crafter
        dependencies: ["04-01"]
        acceptance_criteria:
          - "User confirmation prompt works"
          - "Backup deleted on cancellation"

      - id: "04-03"
        name: "Already up to date"
        scenario: "tests/acceptance/features/version-update-experience/us-002-update-safely.feature::already_up_to_date"
        agent: software-crafter
        dependencies: ["04-01"]
        acceptance_criteria:
          - "No update check doesn't create backup"

      - id: "04-04"
        name: "Update fails - automatic rollback"
        scenario: "tests/acceptance/features/version-update-experience/us-002-update-safely.feature::update_fails_mid_process_automatic_rollback"
        agent: software-crafter
        dependencies: ["04-01"]
        acceptance_criteria:
          - "Automatic rollback on failure"
          - "Previous version restored"

      - id: "04-05"
        name: "Insufficient permissions check"
        scenario: "tests/acceptance/features/version-update-experience/us-002-update-safely.feature::insufficient_permissions_during_update"
        agent: software-crafter
        dependencies: ["04-01"]
        acceptance_criteria:
          - "Permission check before update"
          - "Clear error message"

      - id: "04-06"
        name: "Insufficient disk space check"
        scenario: "tests/acceptance/features/version-update-experience/us-002-update-safely.feature::insufficient_disk_space_during_update"
        agent: software-crafter
        dependencies: ["04-01"]
        acceptance_criteria:
          - "Disk space check (2x installation size)"
          - "Clear error with requirements"

  # Phase 05: Backup Cleanup (US-004)
  - id: "05"
    name: "Backup Lifecycle Management"
    description: "Backup cleanup and maintenance"

    steps:
      - id: "05-01"
        name: "Cleanup backups older than 30 days"
        scenario: "tests/acceptance/features/version-update-experience/us-004-backup-cleanup.feature::cleanup_backups_older_than_30_days"
        agent: software-crafter
        dependencies: ["04-01"]
        acceptance_criteria:
          - "30-day retention policy implemented"
          - "Old backups deleted during update"

      - id: "05-02"
        name: "Handle locked backup directory"
        scenario: "tests/acceptance/features/version-update-experience/us-004-backup-cleanup.feature::backup_directory_is_locked_or_in_use"
        agent: software-crafter
        dependencies: ["05-01"]
        acceptance_criteria:
          - "Locked directories logged as warning"
          - "Update proceeds normally"

      - id: "05-03"
        name: "Handle permission denied on cleanup"
        scenario: "tests/acceptance/features/version-update-experience/us-004-backup-cleanup.feature::insufficient_permissions_to_delete_backup"
        agent: software-crafter
        dependencies: ["05-01"]
        acceptance_criteria:
          - "Permission errors non-blocking"

      - id: "05-04"
        name: "Large number of backups (performance)"
        scenario: "tests/acceptance/features/version-update-experience/us-004-backup-cleanup.feature::large_number_of_backups_performance"
        agent: software-crafter
        dependencies: ["05-01"]
        acceptance_criteria:
          - "Cleanup completes within 10 seconds for 50 backups"

# Dependency Summary
dependencies:
  "01-01": []  # Foundation
  "01-02": ["01-01"]
  "01-03": ["01-01"]
  "01-04": ["01-01"]
  "01-05": ["01-01"]
  "01-06": ["01-05"]
  "01-07": ["01-04", "01-05"]
  "01-08": ["01-07"]
  "02-01": ["01-08"]  # Git workflow complete
  "02-02": ["02-01"]
  "02-03": ["02-01"]
  "03-01": ["02-02"]
  "03-02": ["03-01"]
  "04-01": ["03-02"]  # Version checks complete
  "04-02": ["04-01"]
  "04-03": ["04-01"]
  "04-04": ["04-01"]
  "04-05": ["04-01"]
  "04-06": ["04-01"]
  "05-01": ["04-01"]  # Update orchestration complete
  "05-02": ["05-01"]
  "05-03": ["05-01"]
  "05-04": ["05-01"]

# Implementation Notes
notes:
  - "Each step = 1 TDD cycle (Red → Green → Refactor)"
  - "Steps map 1:1 to acceptance test scenarios"
  - "Dependency order respects baseline: US-005 → US-007 → US-001 → US-002"
  - "Total 24 steps matching 24 acceptance test scenarios"
  - "Agent: software-crafter (all implementation steps)"
