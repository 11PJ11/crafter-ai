# CI/CD Notification Journey Schema
# Version: 1.0
# Owner: leanux-designer (Luna)
# Date: 2026-01-31

schema_version: "1.0"
journey_name: "cicd-notifications"
goal: "Stay informed about pipeline health without alarm fatigue"

persona:
  name: "Developer"
  examples: ["Michele Brissoni", "Alessandro Di Gioia"]
  role: "Commit author responsible for pipeline health"
  context: "High-urgency team culture with developer accountability"

emotional_arc:
  start: "Productive flow (working on features)"
  red_notification: "Urgent concern (I must fix this NOW)"
  investigation: "Focused action (understanding the failure)"
  fix_applied: "Anxious waiting (did my fix work?)"
  green_notification: "Relief + Celebration (I fixed it!)"
  end: "Confidence + Closure (all good, move on)"

trigger: "GitHub Actions workflow completes (success or failure)"
success_criteria: "Team stays informed, failures are fixed quickly, no alarm fatigue"

# =============================================================================
# JOURNEY STEPS
# =============================================================================

steps:
  # ---------------------------------------------------------------------------
  # SCENARIO A: Developer breaks build, fixes it, sees recovery
  # ---------------------------------------------------------------------------

  - id: 1
    name: "Pipeline Failure Notification"
    trigger: "GitHub Actions workflow fails (previous=success, current=failure)"
    action: "Dakota's notification system posts RED message to #cicd"

    slack_message:
      notification_type: "failure"
      blocks:
        - type: "header"
          text:
            type: "plain_text"
            text: "üî¥ Pipeline Failed: CI Pipeline"
            emoji: true

        - type: "section"
          fields:
            - type: "mrkdwn"
              text: "*Branch:*\ninstaller"
            - type: "mrkdwn"
              text: "*Author:*\n<@U01234ABCD>"  # michele.brissoni Slack ID

        - type: "section"
          text:
            type: "mrkdwn"
            text: "üìù *Fix authentication bug*\nCommit: `a1b2c3d`"

        - type: "section"
          text:
            type: "mrkdwn"
            text: "*‚ùå Failed Jobs:*\n‚Ä¢ test (exit code 1)\n‚Ä¢ lint (ruff formatting)"

        - type: "actions"
          elements:
            - type: "button"
              text:
                type: "plain_text"
                text: "View Run"
              url: "https://github.com/Undeadgrishnackh/crafter-ai/actions/runs/123"
              style: "danger"
            - type: "button"
              text:
                type: "plain_text"
                text: "View Commit"
              url: "https://github.com/Undeadgrishnackh/crafter-ai/commit/a1b2c3d"

        - type: "context"
          elements:
            - type: "mrkdwn"
              text: "‚è±Ô∏è Failed at: 2:34 PM"

    shared_artifacts:
      - name: "author"
        source: "git commit author (mapped to Slack user ID)"
        displayed_as: "<@U01234ABCD>"
        consumers:
          - "RED notification (ownership)"
          - "Slack mention (notification trigger)"

      - name: "branch"
        source: "git branch name"
        displayed_as: "installer"
        consumers:
          - "RED notification (context)"
          - "Routing filter (only master/develop/installer)"

      - name: "failed_jobs"
        source: "GitHub Actions job status array"
        displayed_as: "test, lint"
        consumers:
          - "RED notification (actionable info)"
          - "GREEN notification (recovery proof)"

    emotional_state:
      entry: "Productive flow, working on features"
      notification_impact: "Urgent concern (I broke it!)"
      exit: "Focused action (I need to investigate and fix)"

    user_decision:
      prompt: "Developer sees RED notification with @mention"
      options:
        - input: "Click [View Run] to investigate"
          next_step: 2
        - input: "Ignore (alarm fatigue case - what we're preventing)"
          next_step: "alarm_fatigue_scenario"

    design_rationale:
      ownership: "@mention ensures clear responsibility, no diffusion of blame"
      actionability: "Failed jobs listed with error types, not just 'it failed'"
      urgency: "Red color, danger button style, immediate visual impact"
      context: "Commit message + SHA gives developer immediate context"

  # ---------------------------------------------------------------------------

  - id: 2
    name: "Developer Investigates Failure"
    action: "Developer clicks [View Run], opens GitHub Actions log"

    tui_mockup: |
      ‚îå‚îÄ GitHub Actions: CI Pipeline ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ Run #123 - Failed                                       ‚îÇ
      ‚îÇ                                                         ‚îÇ
      ‚îÇ Job: test                                               ‚îÇ
      ‚îÇ   ‚ùå Exit code: 1                                       ‚îÇ
      ‚îÇ                                                         ‚îÇ
      ‚îÇ   tests/test_auth.py::test_token_validation            ‚îÇ
      ‚îÇ   AssertionError: Expected 200, got 401                ‚îÇ
      ‚îÇ                                                         ‚îÇ
      ‚îÇ Developer realizes: "I forgot to mock the auth token"  ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

    emotional_state:
      entry: "Focused investigation"
      realization: "Aha! I know what's wrong"
      exit: "Confident I can fix this"

    user_decision:
      prompt: "Developer understands the failure"
      options:
        - input: "Fix code locally, run tests, push fix"
          next_step: 3

  # ---------------------------------------------------------------------------

  - id: 3
    name: "Developer Pushes Fix"
    action: "Developer commits fix and pushes to installer branch"

    tui_mockup: |
      ‚îå‚îÄ Local Terminal ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ $ git add tests/test_auth.py                            ‚îÇ
      ‚îÇ $ git commit -m "Fix auth mock in tests"                ‚îÇ
      ‚îÇ $ git push origin installer                             ‚îÇ
      ‚îÇ                                                          ‚îÇ
      ‚îÇ Enumerating objects: 5, done.                            ‚îÇ
      ‚îÇ Counting objects: 100% (5/5), done.                      ‚îÇ
      ‚îÇ Writing objects: 100% (3/3), 1.23 KiB | 1.23 MiB/s       ‚îÇ
      ‚îÇ                                                          ‚îÇ
      ‚îÇ To github.com:Undeadgrishnackh/crafter-ai.git           ‚îÇ
      ‚îÇ    a1b2c3d..b2c3d4e  installer -> installer             ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

    shared_artifacts:
      - name: "commit_sha"
        source: "git commit hash (new)"
        displayed_as: "b2c3d4e"
        consumers:
          - "GREEN notification (recovery commit)"
          - "GitHub Actions trigger"

    emotional_state:
      entry: "Confident in fix"
      action: "Push to trigger re-run"
      exit: "Anxious waiting (Please work...)"

    integration_checkpoint: |
      ‚úì Git push triggers GitHub Actions webhook
      ‚úì Dakota's system receives workflow_run event
      ‚úì Previous run ID tracked (123) for state comparison

  # ---------------------------------------------------------------------------

  - id: 4
    name: "Pipeline Recovery Notification"
    trigger: "GitHub Actions workflow succeeds (previous=failure, current=success)"
    action: "Dakota's notification system posts GREEN message to #cicd"

    slack_message:
      notification_type: "back_to_green"
      blocks:
        - type: "header"
          text:
            type: "plain_text"
            text: "‚úÖ Pipeline Recovered: CI Pipeline"
            emoji: true

        - type: "section"
          fields:
            - type: "mrkdwn"
              text: "*Branch:*\ninstaller"
            - type: "mrkdwn"
              text: "*Fixed by:*\n<@U01234ABCD>"  # michele.brissoni Slack ID

        - type: "section"
          text:
            type: "mrkdwn"
            text: "üìù *Fix auth mock in tests*\nCommit: `b2c3d4e`"

        - type: "section"
          text:
            type: "mrkdwn"
            text: "üéâ *Back to green* after 18 minutes\nRecovery commits: 1"

        - type: "section"
          text:
            type: "mrkdwn"
            text: "*Previously failed:*\n‚Ä¢ test ‚úÖ now passing\n‚Ä¢ lint ‚úÖ now passing"

        - type: "actions"
          elements:
            - type: "button"
              text:
                type: "plain_text"
                text: "View Run"
              url: "https://github.com/Undeadgrishnackh/crafter-ai/actions/runs/124"
              style: "primary"
            - type: "button"
              text:
                type: "plain_text"
                text: "View Commit"
              url: "https://github.com/Undeadgrishnackh/crafter-ai/commit/b2c3d4e"

        - type: "context"
          elements:
            - type: "mrkdwn"
              text: "üü¢ All systems healthy"

    shared_artifacts:
      - name: "time_since_failure"
        source: "Dakota's state tracking (current_time - failure_time)"
        displayed_as: "18 minutes"
        consumers:
          - "GREEN notification (recovery speed)"
          - "Metrics (MTTR tracking)"

      - name: "recovery_commit_count"
        source: "Dakota's state tracking (commits between failure and recovery)"
        displayed_as: "1"
        consumers:
          - "GREEN notification (fix complexity indicator)"

      - name: "failed_jobs"
        source: "Previous RED notification data"
        displayed_as: "test ‚úÖ, lint ‚úÖ"
        consumers:
          - "GREEN notification (proof of recovery)"

    emotional_state:
      entry: "Anxious waiting"
      notification_impact: "Relief + Celebration (I fixed it!)"
      exit: "Confidence + Closure (all good, moving on)"

    design_rationale:
      celebration: "üéâ emoji and 'Back to green' creates positive closure"
      team_reassurance: "üü¢ All systems healthy signals all-clear to team"
      credit: "@mention whoever fixed it (recognition + accountability)"
      proof: "Previously failed jobs now passing (validates recovery)"
      context: "Time-since-failure shows responsiveness (18 min = good)"

  # ---------------------------------------------------------------------------
  # SCENARIO B: Developer returns after auto-recovery
  # ---------------------------------------------------------------------------

  - id: 5
    name: "Green Notification After Absence"
    scenario: "Developer was away, teammate fixed the issue"
    trigger: "Developer returns to see GREEN notification (missed RED)"

    slack_message:
      notification_type: "back_to_green"
      blocks:
        - type: "header"
          text:
            type: "plain_text"
            text: "‚úÖ Pipeline Recovered: CI Pipeline"
            emoji: true

        - type: "section"
          fields:
            - type: "mrkdwn"
              text: "*Branch:*\ninstaller"
            - type: "mrkdwn"
              text: "*Fixed by:*\n<@U56789EFGH>"  # alessandro.digioia Slack ID

        - type: "section"
          text:
            type: "mrkdwn"
            text: "üìù *Fix Mike's auth issue*\nCommit: `c3d4e5f`"

        - type: "section"
          text:
            type: "mrkdwn"
            text: "üéâ *Back to green* after 2h 34m\nRecovery commits: 3"

        - type: "section"
          text:
            type: "mrkdwn"
            text: "*Previously failed:*\n‚Ä¢ test ‚úÖ now passing"

        - type: "actions"
          elements:
            - type: "button"
              text:
                type: "plain_text"
                text: "View Run"
              url: "https://github.com/Undeadgrishnackh/crafter-ai/actions/runs/127"
              style: "primary"
            - type: "button"
              text:
                type: "plain_text"
                text: "View Commit"
              url: "https://github.com/Undeadgrishnackh/crafter-ai/commit/c3d4e5f"

        - type: "context"
          elements:
            - type: "mrkdwn"
              text: "üü¢ All systems healthy"

    emotional_state:
      entry: "Returning from absence, catching up"
      notification_impact: "Relief (someone handled it) + Gratitude (thanks teammate)"
      exit: "Calm awareness (I'm up to date now)"

    design_rationale:
      teammate_credit: "Fixed by: @alessandro shows who helped"
      time_context: "2h 34m shows Mike was away for a while"
      commit_count: "3 commits shows teammate put in effort"
      team_culture: "High accountability - even fixes get visibility"

# =============================================================================
# INTEGRATION VALIDATION
# =============================================================================

integration_validation:
  shared_artifact_consistency:
    - artifact: "author"
      must_match_across: [1, 4, 5]
      failure_message: "If git‚ÜíSlack mapping breaks, ownership fails"
      validation: "git commit author maps to correct Slack user ID"

    - artifact: "branch"
      must_match_across: [1, 4, 5]
      failure_message: "If branch name inconsistent, routing breaks"
      validation: "Same branch name in git, GitHub Actions, Slack notification"

    - artifact: "failed_jobs"
      must_match_across: [1, 4]
      failure_message: "If job status parsing breaks, actionable info lost"
      validation: "Failed jobs in RED match recovered jobs in GREEN"

  cross_step_dependencies:
    - from_step: 1
      to_step: 4
      dependency: "previous_run_id tracking"
      data_flow: ["previous_run_id", "current_run_id", "state_transition"]
      risk: "HIGH - if Dakota's state tracking fails, GREEN detection fails"

    - from_step: 1
      to_step: 4
      dependency: "failed_jobs persistence"
      data_flow: ["failed_jobs array"]
      risk: "MEDIUM - if job data not persisted, GREEN can't show recovery proof"

# =============================================================================
# SHARED ARTIFACTS REGISTRY
# =============================================================================

shared_artifacts:
  author:
    source_of_truth: "git commit author (mapped via config to Slack user ID)"
    consumers:
      - "Step 1: RED notification @mention"
      - "Step 4: GREEN notification @mention (credit)"
      - "Slack notification system (triggers user ping)"
    owner: "Dakota's notification service (mapping logic)"
    integration_risk: "HIGH - if mapping breaks, ownership/accountability fails"
    validation: "Test with known git usernames (undeadgrishnackh, 11PJ11)"

  branch:
    source_of_truth: "git branch name"
    consumers:
      - "Step 1: RED notification (context)"
      - "Step 4: GREEN notification (context)"
      - "Dakota's routing filter (master/develop/installer only)"
    owner: "GitHub Actions webhook payload"
    integration_risk: "LOW - branch name is stable"
    validation: "Verify only filtered branches trigger notifications"

  commit_sha:
    source_of_truth: "git commit hash"
    consumers:
      - "Step 1: RED notification (failure commit)"
      - "Step 3: Developer's push (recovery commit)"
      - "Step 4: GREEN notification (recovery commit)"
      - "GitHub Actions links"
    owner: "git commit object"
    integration_risk: "LOW - SHA is immutable"
    validation: "Links to commit pages work correctly"

  commit_message:
    source_of_truth: "git commit message (first line)"
    consumers:
      - "Step 1: RED notification (context)"
      - "Step 4: GREEN notification (context)"
    owner: "git commit object"
    integration_risk: "LOW - message is immutable"
    validation: "Truncate if >100 chars"

  workflow_name:
    source_of_truth: "GitHub Actions workflow file (.github/workflows/*.yml)"
    consumers:
      - "Step 1: RED notification header"
      - "Step 4: GREEN notification header"
    owner: "GitHub Actions configuration"
    integration_risk: "LOW - workflow name rarely changes"
    validation: "Display human-readable name (CI Pipeline)"

  failed_jobs:
    source_of_truth: "GitHub Actions job status API"
    consumers:
      - "Step 1: RED notification (actionable info)"
      - "Step 4: GREEN notification (recovery proof)"
    owner: "GitHub Actions job execution"
    integration_risk: "MEDIUM - if job parsing breaks, actionable info lost"
    validation: "Parse job names and exit codes correctly"

  run_url:
    source_of_truth: "GitHub Actions run URL (workflow_run.html_url)"
    consumers:
      - "Step 1: RED notification [View Run] button"
      - "Step 4: GREEN notification [View Run] button"
    owner: "GitHub Actions webhook payload"
    integration_risk: "LOW - URL structure is stable"
    validation: "Links open directly to run page"

  time_since_failure:
    source_of_truth: "Dakota's state tracking (current_time - failure_timestamp)"
    consumers:
      - "Step 4: GREEN notification (recovery speed)"
    owner: "Dakota's notification service"
    integration_risk: "HIGH - if state tracking fails, GREEN detection fails"
    validation: "Verify timestamp persistence between RED and GREEN"

  previous_run_id:
    source_of_truth: "Dakota's state tracking (previous workflow run ID)"
    consumers:
      - "Internal: State transition detection (RED‚ÜíGREEN, GREEN‚ÜíGREEN)"
    owner: "Dakota's notification service"
    integration_risk: "CRITICAL - without this, GREEN detection impossible"
    validation: "Persist run ID across workflow executions"

  recovery_commit_count:
    source_of_truth: "Dakota's state tracking (commits between failure and recovery)"
    consumers:
      - "Step 4: GREEN notification (fix complexity indicator)"
    owner: "Dakota's notification service"
    integration_risk: "MEDIUM - nice-to-have, not critical"
    validation: "Count commits between failure SHA and recovery SHA"

# =============================================================================
# ANTI-ALARM-FATIGUE DESIGN PATTERNS
# =============================================================================

alarm_fatigue_prevention:
  pattern_1_ownership:
    problem: "Failures with no owner lead to diffusion of responsibility"
    solution: "@mention author in RED notification"
    validation: "Every RED has exactly one @mention"

  pattern_2_closure:
    problem: "Channel full of RED with no resolution creates despair"
    solution: "GREEN notification provides emotional closure"
    validation: "Every RED‚ÜíGREEN transition creates GREEN notification"

  pattern_3_actionability:
    problem: "Generic 'it failed' messages don't help developers act"
    solution: "List failed jobs with error types in RED"
    validation: "Developers can investigate without opening GitHub"

  pattern_4_celebration:
    problem: "Only negative feedback creates demoralizing environment"
    solution: "GREEN uses celebration tone (üéâ, positive language)"
    validation: "Team feels good about resolving issues"

  pattern_5_noise_reduction:
    problem: "Too many notifications create spam"
    solution: "Filter to critical branches only (master/develop/installer)"
    validation: "Feature branch failures don't spam #cicd"

  pattern_6_visual_distinction:
    problem: "All notifications look the same, critical ones get lost"
    solution: "RED=danger style, GREEN=primary style, emoji markers"
    validation: "Developers can triage at a glance"

# =============================================================================
# FUTURE ENHANCEMENTS (Optional)
# =============================================================================

future_enhancements:
  - name: "Notification Batching"
    description: "If multiple failures in 5 min, thread subsequent ones"
    rationale: "Reduce spam during flaky periods"
    implementation: "Dakota tracks last notification timestamp per branch"

  - name: "Edit-in-place Recovery"
    description: "If recovery in <5 min, edit RED to GREEN (no new message)"
    rationale: "Ultra-fast fixes don't need separate GREEN message"
    implementation: "Dakota stores message_ts, uses chat.update API"

  - name: "Thread Context"
    description: "GREEN notification replies to RED in thread"
    rationale: "Keep recovery history connected to original failure"
    implementation: "Dakota stores RED message_ts, uses thread_ts for GREEN"

  - name: "MTTR Metrics"
    description: "Weekly summary: avg time-to-recovery, failure rate"
    rationale: "Team visibility into CI health trends"
    implementation: "Dakota aggregates time_since_failure data"

  - name: "Smart @channel"
    description: "@channel only for master branch failures"
    rationale: "Escalate critical failures to whole team"
    implementation: "Dakota adds @channel mention if branch=master"

  - name: "Flaky Test Detection"
    description: "If same job fails 3x then passes, mark as flaky"
    rationale: "Differentiate intermittent failures from real bugs"
    implementation: "Dakota tracks job failure history"

# =============================================================================
# GHERKIN SCENARIOS (for acceptance testing)
# =============================================================================

gherkin_scenarios: |
  Feature: CI/CD Slack Notifications with Alarm Fatigue Prevention

    Background:
      Given the #cicd Slack channel exists
      And Dakota's notification service is running
      And author mapping is configured:
        | git_username      | slack_user_id |
        | undeadgrishnackh  | U01234ABCD    |
        | 11PJ11            | U56789EFGH    |

    @horizontal @e2e
    Scenario: Developer breaks build and fixes it
      Given the installer branch last build was successful
      When Michele pushes commit a1b2c3d with message "Fix authentication bug"
      And the CI Pipeline workflow fails with jobs ["test", "lint"]
      Then a RED notification appears in #cicd
      And the notification mentions @michele.brissoni
      And the notification shows failed jobs "test, lint"
      And the notification has a [View Run] button

      When Michele pushes commit b2c3d4e with message "Fix auth mock in tests"
      And the CI Pipeline workflow succeeds
      Then a GREEN notification appears in #cicd
      And the notification mentions @michele.brissoni as "Fixed by"
      And the notification shows "Back to green after 18 minutes"
      And the notification shows "Previously failed: test ‚úÖ, lint ‚úÖ"
      And the notification has style "primary" (green button)

    @horizontal @e2e
    Scenario: Teammate fixes developer's broken build
      Given the installer branch last build was successful
      When Michele pushes commit a1b2c3d that breaks the build
      Then a RED notification appears mentioning @michele.brissoni

      When Alessandro pushes commit c3d4e5f with message "Fix Mike's auth issue"
      And the CI Pipeline workflow succeeds after 2h 34m
      Then a GREEN notification appears in #cicd
      And the notification mentions @alessandro.digioia as "Fixed by"
      And the notification shows "Back to green after 2h 34m"
      And the notification shows "Recovery commits: 3"

    @horizontal
    Scenario: Build stays green (no notification spam)
      Given the installer branch last build was successful
      When Michele pushes commit x1y2z3a that passes CI
      Then NO notification is sent to #cicd
      And Slack is silent (preventing green spam)

    @integration
    Scenario: Author mapping validation
      Given git username "undeadgrishnackh" maps to Slack user "U01234ABCD"
      When a failure occurs with author "undeadgrishnackh"
      Then the RED notification must contain "<@U01234ABCD>"
      And NOT contain the git username

    @integration
    Scenario: Failed jobs persistence for GREEN proof
      Given a RED notification showed failed jobs ["test", "lint"]
      When the pipeline recovers
      Then the GREEN notification must show "Previously failed: test ‚úÖ, lint ‚úÖ"
      And the job names must match exactly

    @edge_case
    Scenario: Long commit message truncation
      Given Michele pushes a commit with 200-character message
      When a notification is generated
      Then the commit message is truncated to 100 characters
      And ends with "..."

    @edge_case
    Scenario: Unknown git author (mapping fails)
      Given git username "unknown_user" has no Slack mapping
      When a failure occurs with author "unknown_user"
      Then the RED notification contains plaintext "unknown_user"
      And logs a warning "Author mapping missing for unknown_user"
