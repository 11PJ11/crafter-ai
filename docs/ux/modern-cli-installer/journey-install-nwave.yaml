# Journey Schema: Install nWave for the First Time
# Designer: Luna (leanux-designer)
# Date: 2026-01-31
# Epic: modern_CLI_installer

schema_version: "1.0"
journey_type: "installation"

journey:
  name: "install-nwave"
  goal: "Install nWave and verify it works in Claude Code"

  persona:
    name: "The Explorer"
    role: "Developer discovering nWave for the first time"
    trigger: "Saw demo or conference talk, excited to try it"

  emotional_arc:
    start: "Excited"
    middle: "Confident"
    end: "Delighted"
    pattern: "confidence_building"

  success_criteria:
    - "nWave installed via pipx"
    - "Doctor shows all green"
    - "Welcome message displayed"
    - "User knows to restart Claude"
    - "/nw:version works in Claude"

steps:
  - id: 1
    name: "Run Installation Command"
    command: "pipx install nwave"

    tui_mockup: |
      $ pipx install nwave

      (User found this command in README or conference slide)

    emotional_state:
      entry: "Excited - can't wait to try this"
      exit: "Hopeful - installation starting"

    error_paths:
      - condition: "pipx not found"
        message: |
          ‚úó pipx not found

          nWave requires pipx for isolated installation.
          Install it first:

            pip install pipx
            pipx ensurepath

          Then run: pipx install nwave
        recovery: "User installs pipx, retries"

  - id: 2
    name: "Download Phase"
    command: null  # Automatic after step 1

    tui_mockup: |
      Downloading nWave...

      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 75%
      nwave-${version}.tar.gz (2.3 MB)

      Installing dependencies...
      ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà 100%
      ‚úì rich
      ‚úì click
      ‚úì pyyaml

    shared_artifacts:
      - name: "version"
        source: "pyproject.toml"
        displayed_as: "${version}"

    emotional_state:
      entry: "Hopeful"
      exit: "Anticipation - it's happening!"

  - id: 3
    name: "Pre-flight Checks"
    command: null  # Automatic

    tui_mockup: |
      Resolving install path...
      ‚îî‚îÄ NWAVE_INSTALL_PATH not set
      ‚îî‚îÄ Using default: ~/.claude/agents/nw/

      Validating environment...

      ‚úì Python version      3.12.1 (requires 3.10+)
      ‚úì pipx isolation      isolated environment active
      ‚úì Packages installed  12/12 dependencies verified
      ‚úì Install path        ~/.claude/agents/nw/ writable
      ‚úì Claude Code         found at /usr/local/bin/claude

      All checks passed!

    path_resolution:
      order:
        - env: "NWAVE_INSTALL_PATH"
          priority: 1
          description: "User override via shell environment"
        - config: "config/installer.yaml [paths.install_dir]"
          priority: 2
          description: "Project/global configuration"
        - default: "~/.claude/agents/nw/"
          priority: 3
          description: "Fallback default"

    shared_artifacts:
      - name: "install_path"
        source: "config/installer.yaml with NWAVE_INSTALL_PATH override"
        displayed_as: "${install_path}"
        integration_risk: "LOW (mitigated)"
        risk_explanation: "Configurable path supports custom installations"

    emotional_state:
      entry: "Anticipation"
      exit: "Confidence - environment validated"

    integration_checkpoint:
      - "${version} from pyproject.toml matches download"
      - "${install_path} writable"

  - id: 4
    name: "Framework Installation"
    command: null  # Automatic after pre-flight

    tui_mockup: |
      üì¶ Preparing installation...
         ‚†π Checking source files

      üî® Building distribution...
         ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë‚ñë 67%

      üóÑÔ∏è  Creating backup...
         ‚úÖ Backup created at ${backup_path}

      üöÄ Installing components to ${install_path}
         ü§ñ Agents     ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ${agent_count}   ‚úÖ
         ‚ö° Commands   ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ${command_count} ‚úÖ
         üìã Templates  ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà ${template_count}‚úÖ

      üîç Running validation...
         Component      Status    Count
         ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
         ü§ñ Agents       ‚úÖ        ${agent_count}
         ‚ö° Commands     ‚úÖ        ${command_count}
         üìã Templates    ‚úÖ        ${template_count}
         üìú Manifest     ‚úÖ        Created
         üìê Schema       ‚úÖ        v2.0

      ‚ú® Validation: PASSED

    shared_artifacts:
      - name: "backup_path"
        source: "Generated timestamp path"
        displayed_as: "${backup_path}"
        example_value: "~/.claude/backups/nwave-20260201-001335"
      - name: "install_path"
        source: "resolved from Step 3"
        displayed_as: "${install_path}"
      - name: "agent_count"
        source: "runtime count of dist/ide/agents/"
        displayed_as: "${agent_count}"
      - name: "command_count"
        source: "runtime count of dist/ide/commands/"
        displayed_as: "${command_count}"
      - name: "template_count"
        source: "runtime count of dist/ide/templates/"
        displayed_as: "${template_count}"

    emotional_state:
      entry: "Confidence"
      exit: "Excitement - components installed!"

    design_principles:
      old_pattern: "[timestamp] INFO: Installing agents..."
      new_pattern: "üöÄ Progress bars with emoji headers"
      transformation:
        - "Verbose logs ‚Üí Progress bars with counts"
        - "No visual hierarchy ‚Üí Phased sub-steps"
        - "Plain text ‚Üí Emoji status indicators"

  - id: 5
    name: "Doctor Verification"
    command: "nw doctor"  # Run automatically post-install

    tui_mockup: |
      Running nw doctor...

      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  üè• nWave Health Check                             ‚îÇ
      ‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
      ‚îÇ  ‚úì Core installation      ${install_path}         ‚îÇ
      ‚îÇ  ‚úì Agent files            ${agent_count} agents   ‚îÇ
      ‚îÇ  ‚úì Command files          ${command_count} cmds   ‚îÇ
      ‚îÇ  ‚úì Template files         ${template_count} tmpls ‚îÇ
      ‚îÇ  ‚úì Config valid           nwave.yaml OK           ‚îÇ
      ‚îÇ  ‚úì Permissions            All files accessible    ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

      Status: üíö HEALTHY

    shared_artifacts:
      - name: "install_path"
        source: "resolved from Step 3"
        validation: "Must match Step 4"
      - name: "agent_count"
        source: "runtime count of dist/ide/agents/"
        displayed_as: "${agent_count} agents"
        validation: "Must match Step 4"
      - name: "command_count"
        source: "runtime count of dist/ide/commands/"
        displayed_as: "${command_count} cmds"
        validation: "Must match Step 4"
      - name: "template_count"
        source: "runtime count of dist/ide/templates/"
        displayed_as: "${template_count} tmpls"
        validation: "Must match Step 4"

    emotional_state:
      entry: "Excitement"
      exit: "Trust - verified working"

  - id: 6
    name: "Celebration & Welcome"
    command: null  # Automatic display

    tui_mockup: |
      ‚ñà‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ïó    ‚ñà‚ñà‚ïó ‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïó   ‚ñà‚ñà‚ïó‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
      ‚ñà‚ñà‚ñà‚ñà‚ïó  ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë    ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ïê‚ïê‚ïù
      ‚ñà‚ñà‚ïî‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë ‚ñà‚ïó ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë   ‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
      ‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïë‚ñà‚ñà‚ñà‚ïó‚ñà‚ñà‚ïë‚ñà‚ñà‚ïî‚ïê‚ïê‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ïó ‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïî‚ïê‚ïê‚ïù
      ‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïë‚ïö‚ñà‚ñà‚ñà‚ïî‚ñà‚ñà‚ñà‚ïî‚ïù‚ñà‚ñà‚ïë  ‚ñà‚ñà‚ïë ‚ïö‚ñà‚ñà‚ñà‚ñà‚ïî‚ïù ‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà‚ïó
      ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïê‚ïù‚ïö‚ïê‚ïê‚ïù ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïù  ‚ïö‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïù

      ‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà‚âà

      ‚ú® nWave v${version} installed successfully!

      Your Claude is now powered by nWave.

      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
      ‚îÇ  ‚ö†Ô∏è  IMPORTANT: Restart Claude Code to activate    ‚îÇ
      ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò

      Next steps:
      1. Restart Claude Code (Cmd+Q then reopen)
      2. Try: /nw:version
      3. Try: /nw:help

      üìö Docs: https://nwave.dev/getting-started

    shared_artifacts:
      - name: "version"
        source: "pyproject.toml"
        displayed_as: "v${version}"
        consumers:
          - "Step 2: download progress"
          - "Step 4: installation validation"
          - "Step 6: welcome message"
          - "Step 7: /nw:version output"
      - name: "docs_url"
        source: "nWave/data/config/urls.yaml"
        displayed_as: "${docs_url}"

    emotional_state:
      entry: "Trust"
      exit: "Delighted - wow, that was smooth!"

    critical_instruction:
      message: "Restart Claude Code to activate"
      highlight: true
      reason: "Claude must reload to pick up new agents"

  - id: 7
    name: "Verify in Claude Code"
    command: "/nw:version"
    context: "Inside Claude Code after restart"

    tui_mockup: |
      > /nw:version

      üåä nWave Framework v${version}
      üìç Installed: ${install_path}
      ü§ñ Agents: ${agent_count} | ‚ö° Commands: ${command_count} | üìã Templates: ${template_count}

      ‚úÖ All systems operational

    shared_artifacts:
      - name: "version"
        source: "pyproject.toml"
        validation: "Must match Step 6"
      - name: "install_path"
        source: "resolved path from Step 3"
        validation: "Must match Step 3 and 4"
      - name: "agent_count"
        source: "runtime count of dist/ide/agents/"
        validation: "Must match Step 4 and 5"
      - name: "command_count"
        source: "runtime count of dist/ide/commands/"
        validation: "Must match Step 4 and 5"
      - name: "template_count"
        source: "runtime count of dist/ide/templates/"
        validation: "Must match Step 4 and 5"

    emotional_state:
      entry: "Hopeful - did restart work?"
      exit: "Confident - it works!"

    integration_checkpoint:
      - "${version} matches Step 6"
      - "${install_path} matches Step 3 and 4"
      - "${agent_count} matches Step 4 and 5"
      - "${command_count} matches Step 4 and 5"
      - "${template_count} matches Step 4 and 5"

shared_artifacts:
  version:
    source_of_truth: "pyproject.toml [project.version]"
    displayed_as: "${version}"
    example_value: "1.3.0"
    consumers:
      - "Step 2: Download progress shows version"
      - "Step 4: Installation validation shows version"
      - "Step 6: Welcome message shows version"
      - "Step 7: /nw:version shows version"
    owner: "build system"
    integration_risk: "HIGH"
    risk_explanation: "Version mismatch would confuse users and break trust"
    validation: "All displays must show same version"
    cross_journey_note: "Must match forge:build-local and forge:install-local-candidate"

  install_path:
    source_of_truth: "config/installer.yaml with NWAVE_INSTALL_PATH override"
    displayed_as: "${install_path}"
    resolution_order:
      1: "NWAVE_INSTALL_PATH environment variable (user override)"
      2: "config/installer.yaml [paths.install_dir]"
      3: "Default: ~/.claude/agents/nw/"
    consumers:
      - "Step 3: Pre-flight permissions check"
      - "Step 4: Installation destination"
      - "Step 5: Doctor verification"
      - "Step 7: /nw:version output"
    owner: "installer"
    integration_risk: "LOW (mitigated)"
    risk_explanation: "Configurable path supports custom Claude installations"
    validation: "Path must exist and be writable"
    env_override: "NWAVE_INSTALL_PATH"
    example: "NWAVE_INSTALL_PATH=~/my-claude/agents/nw pipx install nwave"

  backup_path:
    source_of_truth: "Generated timestamp path"
    displayed_as: "${backup_path}"
    example_value: "~/.claude/backups/nwave-20260201-001335"
    consumers:
      - "Step 4: Backup creation confirmation"
    owner: "installer"
    integration_risk: "LOW"
    risk_explanation: "Unique per installation, used for rollback"
    validation: "Backup directory must be created successfully"

  agent_count:
    source_of_truth: "Runtime count of files in dist/ide/agents/"
    displayed_as: "${agent_count} agents"
    example_value: "47"
    cross_journey_note: "Must match forge:build-local and forge:install-local-candidate"
    consumers:
      - "Step 4: Installation progress"
      - "Step 4: Validation table"
      - "Step 5: Doctor output"
      - "Step 7: /nw:version output"
    owner: "build system"
    integration_risk: "LOW"
    risk_explanation: "Count is cosmetic but should be accurate"
    validation: "Count must match actual files"

  command_count:
    source_of_truth: "Runtime count of files in dist/ide/commands/"
    displayed_as: "${command_count} commands"
    example_value: "23"
    consumers:
      - "Step 4: Installation progress"
      - "Step 4: Validation table"
      - "Step 5: Doctor output"
      - "Step 7: /nw:version output"
    owner: "build system"
    integration_risk: "LOW"
    risk_explanation: "Count is cosmetic but should be accurate"
    validation: "Count must match actual files"
    cross_journey_note: "Must match forge:build-local and forge:install-local-candidate"

  template_count:
    source_of_truth: "Runtime count of files in dist/ide/templates/"
    displayed_as: "${template_count} templates"
    example_value: "12"
    cross_journey_note: "Must match forge:build-local and forge:install-local-candidate"
    consumers:
      - "Step 4: Installation progress"
      - "Step 4: Validation table"
      - "Step 5: Doctor output"
      - "Step 7: /nw:version output"
    owner: "build system"
    integration_risk: "LOW"
    risk_explanation: "Count is cosmetic but should be accurate"
    validation: "Count must match actual files"

  docs_url:
    source_of_truth: "nWave/data/config/urls.yaml [docs.getting_started]"
    displayed_as: "${docs_url}"
    example_value: "https://nwave.dev/getting-started"
    consumers:
      - "Step 6: Welcome message"
    owner: "documentation"
    integration_risk: "MEDIUM"
    risk_explanation: "Broken URL frustrates users at critical moment"
    validation: "URL must be reachable and return 200"

integration_validation:
  shared_artifact_consistency:
    - artifact: "version"
      must_match_across: [2, 4, 6, 7]
      failure_message: "Version mismatch detected - check pyproject.toml propagation"

    - artifact: "install_path"
      must_match_across: [3, 4, 5, 7]
      resolution: "Resolved once at Step 3, propagated to all consumers"
      failure_message: "Install path inconsistent - check path resolution logic"

    - artifact: "agent_count"
      must_match_across: [4, 5, 7]
      failure_message: "Agent count mismatch - verify build output"

    - artifact: "command_count"
      must_match_across: [4, 5, 7]
      failure_message: "Command count mismatch - verify build output"

    - artifact: "template_count"
      must_match_across: [4, 5, 7]
      failure_message: "Template count mismatch - verify build output"

  path_resolution_validation:
    description: "Verify install path resolution follows priority order"
    checks:
      - "NWAVE_INSTALL_PATH env var takes highest priority"
      - "config/installer.yaml used when env var not set"
      - "Default ~/.claude/agents/nw/ used as fallback"
      - "Resolved path is displayed in Step 3 output"
      - "Same resolved path used in Steps 4, 5, and 7"

error_paths:
  - id: "err-1"
    name: "pipx Not Installed"
    detection: "which pipx fails"
    severity: "blocking"
    recovery_path: "Install pipx, retry"

  - id: "err-2"
    name: "Python Version Too Old"
    detection: "python --version < 3.10"
    severity: "blocking"
    recovery_path: "Upgrade Python"

  - id: "err-3"
    name: "Permission Denied"
    detection: "Cannot write to ~/.claude/"
    severity: "blocking"
    recovery_path: "Fix permissions"

  - id: "err-4"
    name: "Claude Code Not Found"
    detection: "which claude fails"
    severity: "warning"
    recovery_path: "Install Claude Code"

quality_gates:
  discovery_complete: true
  journey_complete: true
  emotional_coherence: true
  shared_artifacts_tracked: true
  example_data_quality: true

metadata:
  created_by: "Luna (leanux-designer)"
  created_at: "2026-01-31"
  epic: "modern_CLI_installer"
  design_reference: "Astro/Vite - playful, branded, celebratory"
  ready_for_review: true
